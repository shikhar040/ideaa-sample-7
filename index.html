<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PollSocial - Social Polling App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Light Mode Colors */
            --light-bg: #FFFFFF;
            --light-elements: #F0F2F5;
            --light-accent: #4A90E2;
            --light-text: #1C1E21;
            --light-card: #FFFFFF;
            --light-shadow: rgba(0, 0, 0, 0.08);
            --light-border: #E4E6EA;
            
            /* Dark Mode Colors */
            --dark-bg: #0F0F10;
            --dark-elements: #1A1A1C;
            --dark-accent: #3D8BFF;
            --dark-text: #E8E8E8;
            --dark-card: #1A1A1C;
            --dark-shadow: rgba(255, 255, 255, 0.05);
            --dark-border: #2A2A2C;
            
            /* Common */
            --radius: 16px;
            --radius-sm: 12px;
            --transition: all 0.3s ease;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: var(--transition);
            padding-bottom: 80px;
            line-height: 1.5;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        /* Header */
        .app-header {
            position: sticky;
            top: 0;
            background-color: var(--light-bg);
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow-sm);
            z-index: 100;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode .app-header {
            background-color: var(--dark-bg);
        }

        .app-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--light-accent);
            letter-spacing: -0.5px;
        }

        .dark-mode .app-name {
            color: var(--dark-accent);
        }

        .profile-settings-btn {
            position: absolute;
            right: 16px;
            background: none;
            border: none;
            font-size: 1.3rem;
            color: var(--light-text);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
            display: none;
        }

        .profile-settings-btn:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .profile-settings-btn {
            color: var(--dark-text);
        }

        .dark-mode .profile-settings-btn:hover {
            background-color: var(--dark-elements);
        }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--light-bg);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 20px var(--light-shadow);
            z-index: 100;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .dark-mode .bottom-nav {
            background-color: var(--dark-bg);
            box-shadow: 0 -2px 20px var(--dark-shadow);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--light-text);
            padding: 8px 12px;
            border-radius: var(--radius);
            flex: 1;
            max-width: 80px;
        }

        .dark-mode .nav-item {
            color: var(--dark-text);
        }

        .nav-item.active {
            color: var(--light-accent);
            background-color: rgba(74, 144, 226, 0.1);
        }

        .dark-mode .nav-item.active {
            color: var(--dark-accent);
            background-color: rgba(61, 139, 255, 0.15);
        }

        .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 4px;
            transition: var(--transition);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.1);
        }

        /* Screen Containers */
        .screen {
            display: none;
            padding: 16px;
            animation: fadeIn 0.3s ease;
            max-width: 600px;
            margin: 0 auto;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Poll Cards */
        .poll-card {
            background-color: var(--light-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--light-border);
            position: relative;
        }

        .dark-mode .poll-card {
            background-color: var(--dark-card);
            box-shadow: var(--shadow-sm);
            border-color: var(--dark-border);
        }

        .poll-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .profile-pic {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--light-elements);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid var(--light-border);
            transition: var(--transition);
        }

        .profile-pic:hover {
            transform: scale(1.05);
        }

        .dark-mode .profile-pic {
            background-color: var(--dark-elements);
            border-color: var(--dark-border);
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
        }

        .username:hover {
            color: var(--light-accent);
        }

        .dark-mode .username:hover {
            color: var(--dark-accent);
        }

        .username-edit {
            margin-left: 8px;
            font-size: 0.8rem;
            opacity: 0.6;
            transition: var(--transition);
        }

        .username-edit:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .user-display-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: #65676B;
            margin-top: 2px;
        }

        .dark-mode .user-display-name {
            color: #A0A0A0;
        }

        .timestamp {
            font-size: 0.8rem;
            color: #65676B;
            margin-top: 2px;
        }

        .dark-mode .timestamp {
            color: #A0A0A0;
        }

        .poll-question {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 18px;
            line-height: 1.4;
            color: var(--light-text);
        }

        .dark-mode .poll-question {
            color: var(--dark-text);
        }

        .poll-image {
            width: 100%;
            border-radius: var(--radius-sm);
            margin-bottom: 18px;
            max-height: 320px;
            object-fit: cover;
            box-shadow: var(--shadow-sm);
        }

        .poll-options {
            margin-bottom: 18px;
        }

        .poll-option {
            padding: 14px 16px;
            background-color: var(--light-card);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 2px solid var(--light-border);
        }

        .dark-mode .poll-option {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .poll-option:hover {
            border-color: var(--light-accent);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .dark-mode .poll-option:hover {
            border-color: var(--dark-accent);
        }

        .poll-option.selected {
            background-color: var(--light-accent);
            color: white;
            border-color: var(--light-accent);
        }

        .dark-mode .poll-option.selected {
            background-color: var(--dark-accent);
            border-color: var(--dark-accent);
        }

        .poll-option .percentage-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.2);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: var(--radius-sm);
        }

        .poll-option .option-text {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .poll-option .percentage {
            font-weight: 700;
            font-size: 0.9rem;
        }

        .poll-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #65676B;
            margin-bottom: 12px;
            padding: 10px 0;
            border-bottom: 1px solid var(--light-border);
        }

        .dark-mode .poll-stats {
            color: #A0A0A0;
            border-bottom-color: var(--dark-border);
        }

        .engagement-bar {
            display: flex;
            justify-content: space-around;
            padding-top: 12px;
            position: relative;
        }

        .engagement-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: var(--radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .engagement-item:hover {
            background-color: var(--light-elements);
            transform: scale(1.05);
        }

        .dark-mode .engagement-item:hover {
            background-color: var(--dark-elements);
        }

        .engagement-item.active {
            color: var(--light-accent);
        }

        .dark-mode .engagement-item.active {
            color: var(--dark-accent);
        }

        .engagement-icon {
            margin-right: 6px;
            font-size: 1.1rem;
        }

        /* Three-dot menu for polls */
        .poll-menu-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--light-text);
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .poll-menu-btn:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .poll-menu-btn {
            color: var(--dark-text);
        }

        .dark-mode .poll-menu-btn:hover {
            background-color: var(--dark-elements);
        }

        /* Three-dot menu for comments and replies */
        .comment-menu-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #65676B;
            padding: 4px 8px;
            border-radius: 4px;
            transition: var(--transition);
            margin-left: auto;
        }

        .comment-menu-btn:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .comment-menu-btn {
            color: #A0A0A0;
        }

        .dark-mode .comment-menu-btn:hover {
            background-color: var(--dark-elements);
        }

        /* Dropdown menu */
        .dropdown-menu {
            position: absolute;
            background-color: var(--light-card);
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow);
            padding: 8px 0;
            z-index: 10;
            min-width: 180px;
            display: none;
            border: 1px solid var(--light-border);
        }

        .dark-mode .dropdown-menu {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .dropdown-item:hover {
            background-color: var(--dark-elements);
        }

        .dropdown-item i {
            margin-right: 10px;
            width: 16px;
            text-align: center;
        }

        .dropdown-item.delete {
            color: #FF3B30;
        }

        .dropdown-item.report {
            color: #FF9500;
        }

        .dropdown-item.edit {
            color: var(--light-accent);
        }

        .dark-mode .dropdown-item.edit {
            color: var(--dark-accent);
        }

        /* Profile Screen */
        .profile-card {
            background-color: var(--light-card);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            border: 1px solid var(--light-border);
            text-align: center;
        }

        .dark-mode .profile-card {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-pic-large {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background-color: var(--light-elements);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            overflow: hidden;
            cursor: pointer;
            border: 3px solid var(--light-border);
            transition: var(--transition);
        }

        .profile-pic-large:hover {
            transform: scale(1.03);
        }

        .dark-mode .profile-pic-large {
            background-color: var(--dark-elements);
            border-color: var(--dark-border);
        }

        .profile-pic-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            width: 100%;
        }

        .profile-name {
            font-size: 1.6rem;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-username {
            font-size: 1.1rem;
            color: #65676B;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dark-mode .profile-username {
            color: #A0A0A0;
        }

        .username-edit-large {
            margin-left: 8px;
            font-size: 0.9rem;
            opacity: 0.6;
            transition: var(--transition);
            cursor: pointer;
        }

        .username-edit-large:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .profile-details {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
        }

        .profile-detail {
            display: flex;
            align-items: center;
            background-color: var(--light-elements);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }

        .dark-mode .profile-detail {
            background-color: var(--dark-elements);
        }

        .profile-detail i {
            margin-right: 6px;
            color: var(--light-accent);
        }

        .dark-mode .profile-detail i {
            color: var(--dark-accent);
        }

        .profile-stats {
            display: flex;
            justify-content: center;
            margin-bottom: 12px;
            gap: 20px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-weight: 800;
            font-size: 1.2rem;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #65676B;
            font-weight: 500;
        }

        .dark-mode .stat-label {
            color: #A0A0A0;
        }

        .profile-bio {
            line-height: 1.6;
            margin-bottom: 12px;
            color: #65676B;
        }

        .dark-mode .profile-bio {
            color: #A0A0A0;
        }

        .profile-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
        }

        .profile-action-btn {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--light-text);
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-action-btn:hover {
            background-color: var(--light-elements);
            transform: scale(1.1);
        }

        .dark-mode .profile-action-btn {
            color: var(--dark-text);
        }

        .dark-mode .profile-action-btn:hover {
            background-color: var(--dark-elements);
        }

        .profile-user-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
        }

        .follow-btn, .chat-btn {
            padding: 10px 20px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 0.9rem;
        }

        .follow-btn {
            background-color: var(--light-accent);
            color: white;
        }

        .follow-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .dark-mode .follow-btn {
            background-color: var(--dark-accent);
        }

        .follow-btn.following {
            background-color: var(--light-elements);
            color: var(--light-text);
        }

        .dark-mode .follow-btn.following {
            background-color: var(--dark-elements);
            color: var(--dark-text);
        }

        .chat-btn {
            background-color: var(--light-elements);
            color: var(--light-text);
        }

        .chat-btn:hover {
            background-color: var(--light-border);
            transform: translateY(-2px);
        }

        .dark-mode .chat-btn {
            background-color: var(--dark-elements);
            color: var(--dark-text);
        }

        .dark-mode .chat-btn:hover {
            background-color: var(--dark-border);
        }

        /* Profile Tabs */
        .profile-tabs {
            display: flex;
            background-color: var(--light-card);
            border-radius: var(--radius);
            margin-bottom: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--light-border);
        }

        .dark-mode .profile-tabs {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .profile-tab {
            flex: 1;
            text-align: center;
            padding: 14px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            position: relative;
        }

        .profile-tab.active {
            background-color: var(--light-accent);
            color: white;
        }

        .dark-mode .profile-tab.active {
            background-color: var(--dark-accent);
        }

        .profile-tab:not(.active):hover {
            background-color: var(--light-elements);
        }

        .dark-mode .profile-tab:not(.active):hover {
            background-color: var(--dark-elements);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 24px 0 16px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-border);
            letter-spacing: -0.5px;
        }

        .dark-mode .section-title {
            border-bottom-color: var(--dark-border);
        }

        .recent-comment {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            background-color: var(--light-card);
            border-radius: var(--radius);
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--light-border);
            position: relative;
        }

        .recent-comment:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .dark-mode .recent-comment {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .comment-poll-preview {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-sm);
            background-color: var(--light-elements);
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .dark-mode .comment-poll-preview {
            background-color: var(--dark-elements);
        }

        .comment-content {
            flex: 1;
        }

        .comment-poll-question {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .comment-text {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 4px;
        }

        .comment-timestamp {
            font-size: 0.8rem;
            color: #65676B;
        }

        .dark-mode .comment-timestamp {
            color: #A0A0A0;
        }

        /* Create Poll Screen */
        .create-poll-container {
            background-color: var(--light-card);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--light-border);
        }

        .dark-mode .create-poll-container {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            font-size: 1rem;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 2px solid var(--light-border);
            background-color: var(--light-bg);
            color: var(--light-text);
            font-size: 1rem;
            transition: var(--transition);
            font-weight: 500;
        }

        .dark-mode .form-input {
            border-color: var(--dark-border);
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--light-accent);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .dark-mode .form-input:focus {
            border-color: var(--dark-accent);
            box-shadow: 0 0 0 3px rgba(61, 139, 255, 0.2);
        }

        .poll-option-input {
            display: flex;
            margin-bottom: 12px;
            gap: 10px;
        }

        .poll-option-input input {
            flex: 1;
        }

        .remove-option {
            background: none;
            border: none;
            color: #FF3B30;
            cursor: pointer;
            font-size: 1.3rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .remove-option:hover {
            background-color: rgba(255, 59, 48, 0.1);
            transform: scale(1.1);
        }

        .add-option {
            background: none;
            border: 2px dashed var(--light-border);
            color: var(--light-text);
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            transition: var(--transition);
            font-weight: 500;
        }

        .dark-mode .add-option {
            border-color: var(--dark-border);
            color: var(--dark-text);
        }

        .add-option:hover {
            background-color: var(--light-elements);
            border-color: var(--light-accent);
        }

        .dark-mode .add-option:hover {
            background-color: var(--dark-elements);
            border-color: var(--dark-accent);
        }

        .image-preview {
            width: 100%;
            max-height: 220px;
            border-radius: var(--radius-sm);
            margin-top: 12px;
            object-fit: cover;
            display: none;
            box-shadow: var(--shadow-sm);
        }

        .post-poll-btn {
            background-color: var(--light-accent);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        .dark-mode .post-poll-btn {
            background-color: var(--dark-accent);
            box-shadow: 0 4px 12px rgba(61, 139, 255, 0.3);
        }

        .post-poll-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 144, 226, 0.4);
        }

        .dark-mode .post-poll-btn:hover {
            box-shadow: 0 6px 16px rgba(61, 139, 255, 0.4);
        }

        /* Notifications Screen */
        .notification-card {
            display: flex;
            align-items: center;
            padding: 18px;
            background-color: var(--light-card);
            border-radius: var(--radius);
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--light-border);
            cursor: pointer;
        }

        .notification-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .dark-mode .notification-card {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .notification-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--light-elements);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            color: var(--light-accent);
            flex-shrink: 0;
        }

        .dark-mode .notification-icon {
            background-color: var(--dark-elements);
            color: var(--dark-accent);
        }

        .notification-content {
            flex: 1;
        }

        .notification-text {
            font-size: 0.95rem;
            line-height: 1.4;
            font-weight: 500;
        }

        .notification-timestamp {
            font-size: 0.8rem;
            color: #65676B;
            margin-top: 4px;
        }

        .dark-mode .notification-timestamp {
            color: #A0A0A0;
        }

        /* Messages Screen */
        .message-user-list {
            background-color: var(--light-card);
            border-radius: var(--radius);
            padding: 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--light-border);
            overflow: hidden;
        }

        .dark-mode .message-user-list {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .message-user-item {
            display: flex;
            align-items: center;
            padding: 16px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--light-border);
        }

        .message-user-item:last-child {
            border-bottom: none;
        }

        .message-user-item:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .message-user-item:hover {
            background-color: var(--dark-elements);
        }

        .message-user-item.active {
            background-color: var(--light-accent);
            color: white;
        }

        .dark-mode .message-user-item.active {
            background-color: var(--dark-accent);
        }

        .message-user-info {
            flex: 1;
            margin-left: 12px;
        }

        .message-user-name {
            font-weight: 700;
            font-size: 1rem;
        }

        .message-user-status {
            font-size: 0.8rem;
            color: #65676B;
            margin-top: 2px;
        }

        .dark-mode .message-user-status {
            color: #A0A0A0;
        }

        .message-user-item.active .message-user-status {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-time {
            font-size: 0.75rem;
            color: #65676B;
        }

        .dark-mode .message-time {
            color: #A0A0A0;
        }

        .message-user-item.active .message-time {
            color: rgba(255, 255, 255, 0.8);
        }

        .message-thread {
            background-color: var(--light-card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--light-border);
            display: none;
        }

        .message-thread.active {
            display: block;
        }

        .dark-mode .message-thread {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--light-border);
        }

        .dark-mode .message-header {
            border-bottom-color: var(--dark-border);
        }

        .back-to-messages {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: var(--light-text);
            margin-right: 12px;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .back-to-messages:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .back-to-messages {
            color: var(--dark-text);
        }

        .dark-mode .back-to-messages:hover {
            background-color: var(--dark-elements);
        }

        .message-user {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .messages-container {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 8px;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: var(--light-elements);
            border-radius: 10px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--light-accent);
            border-radius: 10px;
        }

        .dark-mode .messages-container::-webkit-scrollbar-track {
            background: var(--dark-elements);
        }

        .dark-mode .messages-container::-webkit-scrollbar-thumb {
            background: var(--dark-accent);
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 18px;
            border-radius: 20px;
            margin-bottom: 12px;
            position: relative;
            line-height: 1.4;
            font-weight: 500;
        }

        .message-received {
            background-color: var(--light-elements);
            align-self: flex-start;
            border-bottom-left-radius: 6px;
        }

        .dark-mode .message-received {
            background-color: var(--dark-elements);
        }

        .message-sent {
            background-color: var(--light-accent);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 6px;
        }

        .dark-mode .message-sent {
            background-color: var(--dark-accent);
        }

        .message-input-container {
            display: flex;
            padding: 12px;
            background-color: var(--light-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--light-border);
        }

        .dark-mode .message-input-container {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .message-input {
            flex: 1;
            padding: 12px 18px;
            border-radius: 24px;
            border: 2px solid var(--light-border);
            background-color: var(--light-bg);
            color: var(--light-text);
            margin-right: 12px;
            font-weight: 500;
        }

        .dark-mode .message-input {
            border-color: var(--dark-border);
            background-color: var(--dark-bg);
        }

        .send-message-btn {
            background-color: var(--light-accent);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .send-message-btn:hover {
            transform: scale(1.1);
        }

        .dark-mode .send-message-btn {
            background-color: var(--dark-accent);
        }

        /* Comment Screen */
        .comment-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--light-bg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            transition: var(--transition);
        }

        .dark-mode .comment-screen {
            background-color: var(--dark-bg);
        }

        .comment-screen.active {
            display: flex;
        }

        .comment-header {
            padding: 18px;
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--light-card);
        }

        .dark-mode .comment-header {
            border-bottom-color: var(--dark-border);
            background-color: var(--dark-card);
        }

        .comment-header .poll-preview {
            display: flex;
            align-items: center;
        }

        .comment-poll-question-preview {
            font-weight: 600;
            margin-left: 12px;
            font-size: 1.1rem;
        }

        .close-comments {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-comments:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .close-comments {
            color: var(--dark-text);
        }

        .dark-mode .close-comments:hover {
            background-color: var(--dark-elements);
        }

        .comments-list {
            flex: 1;
            overflow-y: auto;
            padding: 18px;
        }

        .comment-item {
            display: flex;
            margin-bottom: 18px;
            position: relative;
        }

        .comment-content {
            flex: 1;
            margin-left: 12px;
        }

        .comment-user {
            font-weight: 700;
            margin-bottom: 6px;
            font-size: 1rem;
        }

        .comment-text {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .comment-actions {
            display: flex;
            margin-top: 8px;
            align-items: center;
        }

        .comment-action {
            margin-right: 16px;
            font-size: 0.85rem;
            color: #65676B;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            display: flex;
            align-items: center;
        }

        .comment-action:hover {
            color: var(--light-accent);
        }

        .dark-mode .comment-action {
            color: #A0A0A0;
        }

        .dark-mode .comment-action:hover {
            color: var(--dark-accent);
        }

        .comment-action.active {
            color: var(--light-accent);
        }

        .dark-mode .comment-action.active {
            color: var(--dark-accent);
        }

        .comment-action i {
            margin-right: 4px;
        }

        .reply-btn {
            background: none;
            border: none;
            color: var(--light-accent);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: var(--transition);
        }

        .dark-mode .reply-btn {
            color: var(--dark-accent);
        }

        .reply-btn:hover {
            text-decoration: underline;
        }

        .reply-item {
            margin-left: 20px;
            margin-top: 12px;
            padding-left: 12px;
            border-left: 2px solid var(--light-border);
        }

        .dark-mode .reply-item {
            border-left-color: var(--dark-border);
        }

        .nested-reply {
            margin-left: 20px;
            margin-top: 12px;
            padding-left: 12px;
            border-left: 2px solid var(--light-border);
        }

        .dark-mode .nested-reply {
            border-left-color: var(--dark-border);
        }

        .comment-input-container {
            padding: 18px;
            border-top: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            background-color: var(--light-card);
            position: relative;
        }

        .dark-mode .comment-input-container {
            border-top-color: var(--dark-border);
            background-color: var(--dark-card);
        }

        .comment-input {
            flex: 1;
            padding: 14px 18px;
            border-radius: 24px;
            border: 2px solid var(--light-border);
            background-color: var(--light-bg);
            color: #000000;
            margin-right: 12px;
            font-weight: 500;
            min-height: 44px;
            resize: none;
        }

        .dark-mode .comment-input {
            border-color: var(--dark-border);
            background-color: var(--dark-bg);
            color: #FFFFFF;
        }

        .send-comment-btn {
            background-color: var(--light-accent);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .send-comment-btn:hover {
            transform: scale(1.1);
        }

        .dark-mode .send-comment-btn {
            background-color: var(--dark-accent);
        }

        .replying-to {
            background-color: var(--light-elements);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
            font-size: 0.85rem;
            color: #65676B;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dark-mode .replying-to {
            background-color: var(--dark-elements);
            color: #A0A0A0;
        }

        .cancel-reply {
            background: none;
            border: none;
            color: #FF3B30;
            cursor: pointer;
            font-size: 1rem;
        }

        /* Edit Profile Screen */
        .edit-profile-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--light-bg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            transition: var(--transition);
        }

        .dark-mode .edit-profile-screen {
            background-color: var(--dark-bg);
        }

        .edit-profile-screen.active {
            display: flex;
        }

        .edit-profile-header {
            padding: 18px;
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--light-card);
        }

        .dark-mode .edit-profile-header {
            border-bottom-color: var(--dark-border);
            background-color: var(--dark-card);
        }

        .edit-profile-title {
            font-weight: 700;
            font-size: 1.3rem;
        }

        .close-edit-profile {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .close-edit-profile:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .close-edit-profile {
            color: var(--dark-text);
        }

        .dark-mode .close-edit-profile:hover {
            background-color: var(--dark-elements);
        }

        .edit-profile-content {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .profile-pic-upload {
            text-align: center;
            margin-bottom: 24px;
        }

        .profile-pic-preview {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background-color: var(--light-elements);
            margin: 0 auto 18px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            border: 3px solid var(--light-border);
            transition: var(--transition);
        }

        .profile-pic-preview:hover {
            transform: scale(1.03);
        }

        .dark-mode .profile-pic-preview {
            background-color: var(--dark-elements);
            border-color: var(--dark-border);
        }

        .profile-pic-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-pic-preview .upload-text {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px;
            font-size: 0.85rem;
            text-align: center;
            font-weight: 500;
        }

        .edit-profile-actions {
            padding: 18px;
            border-top: 1px solid var(--light-border);
            display: flex;
            gap: 12px;
            background-color: var(--light-card);
        }

        .dark-mode .edit-profile-actions {
            border-top-color: var(--dark-border);
            background-color: var(--dark-card);
        }

        .save-profile-btn, .cancel-edit-btn {
            flex: 1;
            padding: 14px;
            border-radius: var(--radius);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
        }

        .save-profile-btn {
            background-color: var(--light-accent);
            color: white;
            border: none;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        .save-profile-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 144, 226, 0.4);
        }

        .dark-mode .save-profile-btn {
            background-color: var(--dark-accent);
            box-shadow: 0 4px 12px rgba(61, 139, 255, 0.3);
        }

        .dark-mode .save-profile-btn:hover {
            box-shadow: 0 6px 16px rgba(61, 139, 255, 0.4);
        }

        .cancel-edit-btn {
            background-color: var(--light-elements);
            color: var(--light-text);
            border: none;
        }

        .cancel-edit-btn:hover {
            background-color: var(--light-border);
            transform: translateY(-2px);
        }

        .dark-mode .cancel-edit-btn {
            background-color: var(--dark-elements);
            color: var(--dark-text);
        }

        .dark-mode .cancel-edit-btn:hover {
            background-color: var(--dark-border);
        }

        /* Settings Screen */
        .settings-section {
            margin-bottom: 28px;
        }

        .settings-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--light-border);
            letter-spacing: -0.5px;
        }

        .dark-mode .settings-title {
            border-bottom-color: var(--dark-border);
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px;
            background-color: var(--light-card);
            border-radius: var(--radius);
            margin-bottom: 12px;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--light-border);
        }

        .settings-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--light-accent);
        }

        .dark-mode .settings-item {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .dark-mode .settings-item:hover {
            border-color: var(--dark-accent);
        }

        .settings-label {
            font-weight: 600;
            font-size: 1rem;
        }

        .settings-value {
            color: #65676B;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .dark-mode .settings-value {
            color: #A0A0A0;
        }

        .settings-icon {
            margin-right: 12px;
            width: 22px;
            text-align: center;
            font-size: 1.1rem;
        }

        .danger-zone {
            border: 2px solid #FF3B30;
            border-radius: var(--radius);
            padding: 20px;
            margin-top: 24px;
            background-color: rgba(255, 59, 48, 0.05);
        }

        .dark-mode .danger-zone {
            background-color: rgba(255, 59, 48, 0.1);
        }

        .danger-title {
            color: #FF3B30;
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .logout-btn, .delete-account-btn {
            padding: 14px 20px;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            margin-top: 12px;
            transition: var(--transition);
            border: none;
        }

        .logout-btn {
            background-color: var(--light-elements);
            color: var(--light-text);
        }

        .logout-btn:hover {
            background-color: var(--light-border);
            transform: translateY(-2px);
        }

        .dark-mode .logout-btn {
            background-color: var(--dark-elements);
            color: var(--dark-text);
        }

        .dark-mode .logout-btn:hover {
            background-color: var(--dark-border);
        }

        .delete-account-btn {
            background-color: #FF3B30;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
        }

        .delete-account-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 59, 48, 0.4);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--light-card);
            border-radius: var(--radius);
            padding: 24px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow);
            border: 1px solid var(--light-border);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .dark-mode .modal-content {
            background-color: var(--dark-card);
            border-color: var(--dark-border);
        }

        .modal-title {
            font-weight: 700;
            margin-bottom: 16px;
            font-size: 1.3rem;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: var(--radius);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
        }

        .modal-btn-primary {
            background-color: var(--light-accent);
            color: white;
            box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(74, 144, 226, 0.4);
        }

        .dark-mode .modal-btn-primary {
            background-color: var(--dark-accent);
            box-shadow: 0 4px 12px rgba(61, 139, 255, 0.3);
        }

        .dark-mode .modal-btn-primary:hover {
            box-shadow: 0 6px 16px rgba(61, 139, 255, 0.4);
        }

        .modal-btn-secondary {
            background-color: var(--light-elements);
            color: var(--light-text);
        }

        .modal-btn-secondary:hover {
            background-color: var(--light-border);
            transform: translateY(-2px);
        }

        .dark-mode .modal-btn-secondary {
            background-color: var(--dark-elements);
            color: var(--dark-text);
        }

        .dark-mode .modal-btn-secondary:hover {
            background-color: var(--dark-border);
        }

        .modal-btn-danger {
            background-color: #FF3B30;
            color: white;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
        }

        .modal-btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 59, 48, 0.4);
        }

        /* Report Modal */
        .report-option {
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
        }

        .report-option input {
            margin-right: 10px;
            margin-top: 4px;
        }

        .custom-report {
            margin-top: 16px;
        }

        .custom-report textarea {
            width: 100%;
            border: 1px solid var(--light-border);
            border-radius: 4px;
            padding: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            margin-top: 8px;
            background-color: var(--light-bg);
            color: var(--light-text);
        }

        .dark-mode .custom-report textarea {
            border-color: var(--dark-border);
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        /* Settings Modals */
        .settings-modal-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--light-border);
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-modal-option:hover {
            background-color: var(--light-elements);
        }

        .dark-mode .settings-modal-option {
            border-bottom-color: var(--dark-border);
        }

        .dark-mode .settings-modal-option:hover {
            background-color: var(--dark-elements);
        }

        .settings-modal-option.active {
            color: var(--light-accent);
        }

        .dark-mode .settings-modal-option.active {
            color: var(--dark-accent);
        }

        .settings-modal-option i {
            font-size: 1.2rem;
        }

        /* Utility Classes */
        .hidden {
            display: none;
        }

        .text-center {
            text-align: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .p-10 {
            padding: 10px;
        }

        .empty-state {
            text-align: center;
            padding: 50px 24px;
            color: #65676B;
        }

        .dark-mode .empty-state {
            color: #A0A0A0;
        }

        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 18px;
            opacity: 0.5;
        }

        .empty-state p {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .screen {
                padding: 12px;
            }
            
            .poll-card, .profile-card, .create-poll-container, 
            .notification-card, .message-user-list, .settings-item {
                padding: 16px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-pic-large {
                margin: 0 auto 16px;
            }
            
            .profile-stats {
                justify-content: center;
            }
            
            .profile-actions {
                top: 16px;
                right: 16px;
            }
            
            .app-header {
                padding: 14px;
            }
            
            .bottom-nav {
                padding: 10px 0;
            }
            
            .nav-item {
                padding: 6px 8px;
                font-size: 0.7rem;
            }
            
            .nav-icon {
                font-size: 1.2rem;
            }
            
            .profile-details {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 360px) {
            .poll-option-input {
                flex-direction: column;
            }
            
            .remove-option {
                width: 100%;
                height: 44px;
                border-radius: var(--radius-sm);
                margin-top: 8px;
            }
            
            .profile-stats {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
        }

        @media (min-width: 768px) {
            .screen {
                max-width: 500px;
            }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <header class="app-header">
        <h1 class="app-name">PollSocial</h1>
        <button class="profile-settings-btn" id="profileSettingsBtn">
            <i class="fas fa-cog"></i>
        </button>
    </header>

    <!-- Home Screen -->
    <section id="homeScreen" class="screen active">
        <div id="pollsContainer">
            <!-- Polls will be dynamically added here -->
        </div>
    </section>

    <!-- Create Screen -->
    <section id="createScreen" class="screen">
        <div class="create-poll-container">
            <h2 class="text-center mb-10">Create a Poll</h2>
            <div class="form-group">
                <label class="form-label" for="pollQuestion">Poll Question</label>
                <input type="text" id="pollQuestion" class="form-input" placeholder="Ask something...">
            </div>
            <div class="form-group">
                <label class="form-label" for="pollImage">Add Image (Optional)</label>
                <input type="file" id="pollImage" class="form-input" accept="image/*">
                <img id="pollImagePreview" class="image-preview" alt="Poll image preview">
            </div>
            <div class="form-group">
                <label class="form-label">Poll Options</label>
                <div id="pollOptionsContainer">
                    <div class="poll-option-input">
                        <input type="text" class="form-input poll-option-input-field" placeholder="Option 1">
                        <button class="remove-option hidden"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="poll-option-input">
                        <input type="text" class="form-input poll-option-input-field" placeholder="Option 2">
                        <button class="remove-option hidden"><i class="fas fa-times"></i></button>
                    </div>
                </div>
                <button class="add-option" id="addOption">
                    <i class="fas fa-plus"></i> Add Option
                </button>
            </div>
            <button class="post-poll-btn" id="postPoll">Post Poll</button>
        </div>
    </section>

    <!-- Messages Screen -->
    <section id="messagesScreen" class="screen">
        <div class="message-user-list" id="messageUserList">
            <!-- Message users will be dynamically added here -->
        </div>
        
        <div class="message-thread" id="messageThread">
            <div class="message-header">
                <button class="back-to-messages" id="backToMessages">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="message-user" id="currentMessageUser">Alex Chen</div>
            </div>
            <div class="messages-container" id="messagesContainer">
                <!-- Messages will be dynamically added here -->
            </div>
            <div class="message-input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="Type a message...">
                <button class="send-message-btn" id="sendMessage">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- Notifications Screen -->
    <section id="notificationsScreen" class="screen">
        <div id="notificationsContainer">
            <!-- Notifications will be dynamically added here -->
        </div>
    </section>

    <!-- Profile Screen -->
    <section id="profileScreen" class="screen">
        <div class="profile-card">
            <div class="profile-header">
                <div class="profile-pic-large" id="profilePicLarge">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="profileName">Jordan Taylor</div>
                    <div class="profile-username" id="profileUsername">
                        <span>@jordant</span>
                        <i class="fas fa-pencil-alt username-edit-large"></i>
                    </div>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <i class="fas fa-venus-mars"></i>
                            <span id="profileGender">Female</span>
                        </div>
                        <div class="profile-detail">
                            <i class="fas fa-user-tag"></i>
                            <span id="profilePronoun">She/Her</span>
                        </div>
                    </div>
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-value">1.2K</div>
                            <div class="stat-label">Followers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">24.5K</div>
                            <div class="stat-label">Impressions</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">356</div>
                            <div class="stat-label">Likes</div>
                        </div>
                    </div>
                    <div class="profile-bio" id="profileBio">
                        Digital designer & productivity enthusiast. Love creating polls about tech, design, and lifestyle.
                    </div>
                </div>
            </div>
            <div class="profile-actions">
                <button class="profile-action-btn" id="settingsBtn">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="profile-action-btn" id="editProfileBtn">
                    <i class="fas fa-pencil-alt"></i>
                </button>
            </div>
        </div>

        <!-- Profile Tabs -->
        <div class="profile-tabs">
            <div class="profile-tab active" data-tab="polls">Polls</div>
            <div class="profile-tab" data-tab="comments">Comments</div>
        </div>

        <!-- Polls Tab Content -->
        <div class="tab-content active" id="pollsTab">
            <div id="userPollsContainer">
                <!-- User's polls will be dynamically added here -->
            </div>
        </div>

        <!-- Comments Tab Content -->
        <div class="tab-content" id="commentsTab">
            <h3 class="section-title">Recent Comments</h3>
            <div id="userCommentsContainer">
                <!-- User's comments will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- User Profile Screen -->
    <section id="userProfileScreen" class="screen">
        <div class="profile-card">
            <div class="profile-header">
                <div class="profile-pic-large" id="userProfilePicLarge">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="userProfileName">User Name</div>
                    <div class="profile-username" id="userProfileUsername">
                        <span>@username</span>
                    </div>
                    <div class="profile-details">
                        <div class="profile-detail">
                            <i class="fas fa-venus-mars"></i>
                            <span id="userProfileGender">Not specified</span>
                        </div>
                        <div class="profile-detail">
                            <i class="fas fa-user-tag"></i>
                            <span id="userProfilePronoun">Not specified</span>
                        </div>
                    </div>
                    <div class="profile-stats">
                        <div class="stat">
                            <div class="stat-value" id="userFollowers">0</div>
                            <div class="stat-label">Followers</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="userImpressions">0</div>
                            <div class="stat-label">Impressions</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="userLikes">0</div>
                            <div class="stat-label">Likes</div>
                        </div>
                    </div>
                    <div class="profile-bio" id="userProfileBio">
                        User bio will appear here.
                    </div>
                </div>
            </div>
            <div class="profile-user-actions">
                <button class="follow-btn" id="followUserBtn">Follow</button>
                <button class="chat-btn" id="chatUserBtn">Chat</button>
            </div>
        </div>

        <!-- Profile Tabs -->
        <div class="profile-tabs">
            <div class="profile-tab active" data-tab="userPolls">Polls</div>
            <div class="profile-tab" data-tab="userComments">Comments</div>
        </div>

        <!-- Polls Tab Content -->
        <div class="tab-content active" id="userPollsTab">
            <div id="otherUserPollsContainer">
                <!-- User's polls will be dynamically added here -->
            </div>
        </div>

        <!-- Comments Tab Content -->
        <div class="tab-content" id="userCommentsTab">
            <h3 class="section-title">Recent Comments</h3>
            <div id="otherUserCommentsContainer">
                <!-- User's comments will be dynamically added here -->
            </div>
        </div>
    </section>

    <!-- Settings Screen -->
    <section id="settingsScreen" class="screen">
        <div class="settings-section">
            <h3 class="settings-title">Account Settings</h3>
            <div class="settings-item" id="loginMethodItem">
                <div>
                    <div class="settings-label">
                        <i class="settings-icon fas fa-sign-in-alt"></i>
                        Login Method
                    </div>
                    <div class="settings-value" id="loginMethodValue">Google</div>
                </div>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="changePasswordItem">
                <div>
                    <div class="settings-label">
                        <i class="settings-icon fas fa-key"></i>
                        Change Password
                    </div>
                    <div class="settings-value">Last changed 2 months ago</div>
                </div>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="privacySettingsItem">
                <div>
                    <div class="settings-label">
                        <i class="settings-icon fas fa-lock"></i>
                        Privacy Settings
                    </div>
                    <div class="settings-value" id="privacyValue">Public</div>
                </div>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-title">App Preferences</h3>
            <div class="settings-item" id="themeSettingsItem">
                <div>
                    <div class="settings-label">
                        <i class="settings-icon fas fa-palette"></i>
                        Theme
                    </div>
                    <div class="settings-value" id="themeValue">Auto</div>
                </div>
                <i class="fas fa-chevron-right"></i>
            </div>
            <div class="settings-item" id="notificationSettingsItem">
                <div>
                    <div class="settings-label">
                        <i class="settings-icon fas fa-bell"></i>
                        Notifications
                    </div>
                    <div class="settings-value" id="notificationValue">Enabled</div>
                </div>
                <i class="fas fa-chevron-right"></i>
            </div>
        </div>

        <div class="danger-zone">
            <div class="danger-title">Danger Zone</div>
            <button class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
            <button class="delete-account-btn" id="deleteAccountBtn">
                <i class="fas fa-trash"></i> Delete Account
            </button>
        </div>
    </section>

    <!-- Comment Screen -->
    <div class="comment-screen" id="commentScreen">
        <div class="comment-header">
            <div class="poll-preview">
                <div class="profile-pic">
                    <i class="fas fa-user"></i>
                </div>
                <div class="comment-poll-question-preview" id="commentPollQuestion">What's your favorite programming language for web development?</div>
            </div>
            <button class="close-comments" id="closeComments">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="comments-list" id="commentsList">
            <!-- Comments will be dynamically added here -->
        </div>
        <div class="comment-input-container">
            <div class="replying-to" id="replyingTo" style="display: none;">
                <span id="replyingToText">Replying to <strong>Alex Chen</strong></span>
                <button class="cancel-reply" id="cancelReply">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <textarea class="comment-input" id="commentInput" placeholder="Write a comment..."></textarea>
            <button class="send-comment-btn" id="sendComment">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Edit Profile Screen -->
    <div class="edit-profile-screen" id="editProfileScreen">
        <div class="edit-profile-header">
            <div class="edit-profile-title">Edit Profile</div>
            <button class="close-edit-profile" id="closeEditProfile">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="edit-profile-content">
            <div class="profile-pic-upload">
                <div class="profile-pic-preview" id="profilePicPreview">
                    <i class="fas fa-user fa-2x"></i>
                    <div class="upload-text">Tap to change</div>
                </div>
                <input type="file" id="profilePicInput" accept="image/*" style="display: none;">
            </div>
            <div class="form-group">
                <label class="form-label" for="editDisplayName">Display Name</label>
                <input type="text" id="editDisplayName" class="form-input" value="Jordan Taylor">
            </div>
            <div class="form-group">
                <label class="form-label" for="editUsername">Username</label>
                <input type="text" id="editUsername" class="form-input" value="jordant">
            </div>
            <div class="form-group">
                <label class="form-label" for="editGender">Gender</label>
                <select id="editGender" class="form-input">
                    <option value="female">Female</option>
                    <option value="male">Male</option>
                    <option value="non-binary">Non-binary</option>
                    <option value="other">Other</option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="editPronoun">Pronouns</label>
                <select id="editPronoun" class="form-input">
                    <option value="she-her">She/Her</option>
                    <option value="he-him">He/Him</option>
                    <option value="they-them">They/Them</option>
                    <option value="other">Other</option>
                    <option value="prefer-not-to-say">Prefer not to say</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label" for="editBio">Bio</label>
                <textarea id="editBio" class="form-input" rows="4">Digital designer & productivity enthusiast. Love creating polls about tech, design, and lifestyle.</textarea>
            </div>
        </div>
        <div class="edit-profile-actions">
            <button class="cancel-edit-btn" id="cancelEditProfile">Cancel</button>
            <button class="save-profile-btn" id="saveProfile">Save</button>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="logoutModal">
        <div class="modal-content">
            <div class="modal-title">Logout</div>
            <p>Are you sure you want to logout?</p>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelLogout">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="confirmLogout">Logout</button>
            </div>
        </div>
    </div>

    <div class="modal" id="deleteAccountModal">
        <div class="modal-content">
            <div class="modal-title">Delete Account</div>
            <p>This action cannot be undone. All your data will be permanently deleted.</p>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelDelete">Cancel</button>
                <button class="modal-btn modal-btn-danger" id="confirmDelete">Delete Account</button>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="modal" id="reportModal">
        <div class="modal-content">
            <div class="modal-title">Report Content</div>
            <div class="report-option">
                <input type="checkbox" id="abusive">
                <label for="abusive">Abusive behavior or harassment</label>
            </div>
            <div class="report-option">
                <input type="checkbox" id="toxic">
                <label for="toxic">Toxic content</label>
            </div>
            <div class="report-option">
                <input type="checkbox" id="spam">
                <label for="spam">Spam or misleading content</label>
            </div>
            <div class="report-option">
                <input type="checkbox" id="hate-speech">
                <label for="hate-speech">Hate speech</label>
            </div>
            <div class="custom-report">
                <label for="custom-report">Other (please specify):</label>
                <textarea id="custom-report" placeholder="Describe the issue..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelReport">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="submitReport">Submit Report</button>
            </div>
        </div>
    </div>

    <!-- Settings Modals -->
    <div class="modal" id="privacySettingsModal">
        <div class="modal-content">
            <div class="modal-title">Privacy Settings</div>
            <div class="settings-modal-option" data-value="public">
                <div>
                    <div class="settings-label">Public</div>
                    <div class="settings-value">Anyone can see your profile and polls</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="settings-modal-option" data-value="private">
                <div>
                    <div class="settings-label">Private</div>
                    <div class="settings-value">Only followers can see your content</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelPrivacy">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="savePrivacy">Save</button>
            </div>
        </div>
    </div>

    <div class="modal" id="themeSettingsModal">
        <div class="modal-content">
            <div class="modal-title">Theme Settings</div>
            <div class="settings-modal-option" data-value="light">
                <div>
                    <div class="settings-label">Light</div>
                    <div class="settings-value">Always use light theme</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="settings-modal-option" data-value="dark">
                <div>
                    <div class="settings-label">Dark</div>
                    <div class="settings-value">Always use dark theme</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="settings-modal-option" data-value="auto">
                <div>
                    <div class="settings-label">Auto</div>
                    <div class="settings-value">Follow system theme</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelTheme">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="saveTheme">Save</button>
            </div>
        </div>
    </div>

    <div class="modal" id="notificationSettingsModal">
        <div class="modal-content">
            <div class="modal-title">Notification Settings</div>
            <div class="settings-modal-option" data-value="enabled">
                <div>
                    <div class="settings-label">Enabled</div>
                    <div class="settings-value">Receive all notifications</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="settings-modal-option" data-value="disabled">
                <div>
                    <div class="settings-label">Disabled</div>
                    <div class="settings-value">No notifications</div>
                </div>
                <i class="fas fa-check" style="display: none;"></i>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-secondary" id="cancelNotifications">Cancel</button>
                <button class="modal-btn modal-btn-primary" id="saveNotifications">Save</button>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-item active" data-screen="homeScreen">
            <i class="nav-icon fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" data-screen="createScreen">
            <i class="nav-icon fas fa-plus-square"></i>
            <span>Create</span>
        </div>
        <div class="nav-item" data-screen="messagesScreen">
            <i class="nav-icon fas fa-comments"></i>
            <span>Messages</span>
        </div>
        <div class="nav-item" data-screen="notificationsScreen">
            <i class="nav-icon fas fa-bell"></i>
            <span>Notifications</span>
        </div>
        <div class="nav-item" data-screen="profileScreen">
            <i class="nav-icon fas fa-user"></i>
            <span>Profile</span>
        </div>
    </nav>

    <script>
        // App State
        const appState = {
            currentUser: {
                id: 1,
                name: "Jordan Taylor",
                username: "jordant",
                bio: "Digital designer & productivity enthusiast. Love creating polls about tech, design, and lifestyle.",
                profilePic: null,
                gender: "female",
                pronoun: "she-her",
                followers: 1200,
                impressions: 24500,
                likes: 356,
                loginMethod: "google",
                privacy: "public",
                theme: "auto",
                notifications: "enabled"
            },
            dummyUsers: [
                {
                    id: 2,
                    name: "Shikhar Dixit",
                    username: "shikhard",
                    bio: "Tech enthusiast and poll creator. Love discussing new technologies and trends.",
                    profilePic: null,
                    gender: "male",
                    pronoun: "he-him",
                    followers: 850,
                    impressions: 12000,
                    likes: 210,
                    isFollowing: false
                },
                {
                    id: 3,
                    name: "Cosmicpoll",
                    username: "cosmicpoll",
                    bio: "Creating polls about space, science, and the universe. Ask me anything about cosmos!",
                    profilePic: null,
                    gender: "non-binary",
                    pronoun: "they-them",
                    followers: 3200,
                    impressions: 45000,
                    likes: 890,
                    isFollowing: true
                },
                {
                    id: 4,
                    name: "Nishkarsh Mishra",
                    username: "nishkarsh",
                    bio: "Developer and content creator. Passionate about open source and community building.",
                    profilePic: null,
                    gender: "male",
                    pronoun: "he-him",
                    followers: 1500,
                    impressions: 28000,
                    likes: 420,
                    isFollowing: false
                },
                {
                    id: 5,
                    name: "Swatantra Singh",
                    username: "swatantra",
                    bio: "Digital marketer and social media strategist. Love analyzing trends and user behavior.",
                    profilePic: null,
                    gender: "male",
                    pronoun: "he-him",
                    followers: 2100,
                    impressions: 35000,
                    likes: 650,
                    isFollowing: false
                },
                {
                    id: 6,
                    name: "Vimal Awasthi",
                    username: "vimala",
                    bio: "UI/UX designer focused on creating beautiful and functional interfaces.",
                    profilePic: null,
                    gender: "female",
                    pronoun: "she-her",
                    followers: 1800,
                    impressions: 32000,
                    likes: 540,
                    isFollowing: true
                },
                {
                    id: 7,
                    name: "Shubham Dey",
                    username: "shubhamd",
                    bio: "Full-stack developer and tech blogger. Sharing knowledge and building cool stuff.",
                    profilePic: null,
                    gender: "male",
                    pronoun: "he-him",
                    followers: 950,
                    impressions: 15000,
                    likes: 320,
                    isFollowing: false
                }
            ],
            polls: [
                {
                    id: 1,
                    userId: 2,
                    userName: "Shikhar Dixit",
                    userUsername: "shikhard",
                    userProfilePic: null,
                    question: "What's your favorite programming language for web development?",
                    options: [
                        { id: 1, text: "JavaScript", votes: 42, percentage: 42 },
                        { id: 2, text: "Python", votes: 28, percentage: 28 },
                        { id: 3, text: "TypeScript", votes: 18, percentage: 18 },
                        { id: 4, text: "Other", votes: 12, percentage: 12 }
                    ],
                    image: null,
                    likes: 24,
                    comments: 8,
                    shares: 3,
                    impressions: 1250,
                    timestamp: "2 hours ago",
                    userVoted: false,
                    userVoteOption: null,
                    userLiked: false
                },
                {
                    id: 2,
                    userId: 3,
                    userName: "Cosmicpoll",
                    userUsername: "cosmicpoll",
                    userProfilePic: null,
                    question: "Which social media platform do you use most frequently?",
                    options: [
                        { id: 1, text: "Instagram", votes: 35, percentage: 35 },
                        { id: 2, text: "TikTok", votes: 30, percentage: 30 },
                        { id: 3, text: "Twitter", votes: 20, percentage: 20 },
                        { id: 4, text: "Facebook", votes: 15, percentage: 15 }
                    ],
                    image: null,
                    likes: 42,
                    comments: 15,
                    shares: 7,
                    impressions: 890,
                    timestamp: "5 hours ago",
                    userVoted: false,
                    userVoteOption: null,
                    userLiked: false
                },
                {
                    id: 3,
                    userId: 4,
                    userName: "Nishkarsh Mishra",
                    userUsername: "nishkarsh",
                    userProfilePic: null,
                    question: "What's your preferred method for staying productive?",
                    options: [
                        { id: 1, text: "Pomodoro Technique", votes: 40, percentage: 40 },
                        { id: 2, text: "Time Blocking", votes: 25, percentage: 25 },
                        { id: 3, text: "To-Do Lists", votes: 20, percentage: 20 },
                        { id: 4, text: "No specific method", votes: 15, percentage: 15 }
                    ],
                    image: "https://images.unsplash.com/photo-1542831371-29b0f74f9713?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80",
                    likes: 31,
                    comments: 12,
                    shares: 5,
                    impressions: 2100,
                    timestamp: "1 day ago",
                    userVoted: false,
                    userVoteOption: null,
                    userLiked: false
                }
            ],
            userPolls: [
                {
                    id: 4,
                    userId: 1,
                    userName: "Jordan Taylor",
                    userUsername: "jordant",
                    userProfilePic: null,
                    question: "What's your go-to design tool in 2023?",
                    options: [
                        { id: 1, text: "Figma", votes: 65, percentage: 65 },
                        { id: 2, text: "Adobe XD", votes: 20, percentage: 20 },
                        { id: 3, text: "Sketch", votes: 10, percentage: 10 },
                        { id: 4, text: "Other", votes: 5, percentage: 5 }
                    ],
                    image: null,
                    likes: 42,
                    comments: 18,
                    shares: 7,
                    impressions: 3200,
                    timestamp: "3 hours ago",
                    userVoted: false,
                    userVoteOption: null,
                    userLiked: false
                }
            ],
            comments: [
                {
                    id: 1,
                    pollId: 1,
                    userId: 3,
                    userName: "Cosmicpoll",
                    userUsername: "cosmicpoll",
                    userProfilePic: null,
                    text: "I'm a big fan of TypeScript - the type safety has saved me so many times!",
                    likes: 5,
                    timestamp: "2h",
                    userLiked: false,
                    replies: [
                        {
                            id: 2,
                            pollId: 1,
                            userId: 2,
                            userName: "Shikhar Dixit",
                            userUsername: "shikhard",
                            userProfilePic: null,
                            text: "Completely agree! The developer experience is so much better with TypeScript.",
                            likes: 2,
                            timestamp: "1h",
                            userLiked: false,
                            replies: [
                                {
                                    id: 5,
                                    pollId: 1,
                                    userId: 1,
                                    userName: "Jordan Taylor",
                                    userUsername: "jordant",
                                    userProfilePic: null,
                                    text: "I've been meaning to learn TypeScript. Any good resources?",
                                    likes: 1,
                                    timestamp: "30m",
                                    userLiked: false,
                                    replies: []
                                }
                            ]
                        }
                    ]
                },
                {
                    id: 3,
                    pollId: 1,
                    userId: 4,
                    userName: "Nishkarsh Mishra",
                    userUsername: "nishkarsh",
                    userProfilePic: null,
                    text: "Python with Django for backend, JavaScript/React for frontend is my perfect stack.",
                    likes: 3,
                    timestamp: "45m",
                    userLiked: false,
                    replies: []
                },
                {
                    id: 4,
                    pollId: 4,
                    userId: 1,
                    userName: "Jordan Taylor",
                    userUsername: "jordant",
                    userProfilePic: null,
                    text: "I've been using Figma for all my design work and it's been amazing for collaboration!",
                    likes: 8,
                    timestamp: "2h",
                    userLiked: false,
                    replies: []
                }
            ],
            messageUsers: [
                {
                    id: 2,
                    name: "Shikhar Dixit",
                    username: "shikhard",
                    profilePic: null,
                    status: "Online",
                    lastSeen: "2 min ago",
                    messages: [
                        {
                            id: 1,
                            senderId: 2,
                            text: "Hey! I saw your poll about productivity methods. The Pomodoro technique has been a game changer for me!",
                            timestamp: "10:30 AM"
                        },
                        {
                            id: 2,
                            senderId: 1,
                            text: "Really? I've been meaning to try it. Any tips for getting started?",
                            timestamp: "10:32 AM"
                        },
                        {
                            id: 3,
                            senderId: 2,
                            text: "Definitely! Start with 25-minute focus sessions and 5-minute breaks. After 4 sessions, take a longer break. There are great apps to help!",
                            timestamp: "10:35 AM"
                        }
                    ]
                },
                {
                    id: 3,
                    name: "Cosmicpoll",
                    username: "cosmicpoll",
                    profilePic: null,
                    status: "Offline",
                    lastSeen: "1 hour ago",
                    messages: [
                        {
                            id: 1,
                            senderId: 3,
                            text: "Loved your poll about design tools! Figma is definitely the industry standard now.",
                            timestamp: "Yesterday"
                        },
                        {
                            id: 2,
                            senderId: 1,
                            text: "Thanks! Yeah, Figma's collaboration features are unmatched.",
                            timestamp: "Yesterday"
                        }
                    ]
                },
                {
                    id: 4,
                    name: "Nishkarsh Mishra",
                    username: "nishkarsh",
                    profilePic: null,
                    status: "Online",
                    lastSeen: "Just now",
                    messages: [
                        {
                            id: 1,
                            senderId: 4,
                            text: "Hey Jordan! Your polls are always so interesting. How do you come up with the questions?",
                            timestamp: "2 days ago"
                        }
                    ]
                }
            ],
            notifications: [
                {
                    id: 1,
                    type: "like",
                    userId: 3,
                    userName: "Cosmicpoll",
                    userUsername: "cosmicpoll",
                    pollId: 4,
                    pollQuestion: "What's your go-to design tool in 2023?",
                    commentId: null,
                    timestamp: "10 minutes ago",
                    read: false
                },
                {
                    id: 2,
                    type: "comment",
                    userId: 2,
                    userName: "Shikhar Dixit",
                    userUsername: "shikhard",
                    pollId: 1,
                    pollQuestion: "What's your favorite programming language for web development?",
                    commentId: 1,
                    timestamp: "1 hour ago",
                    read: false
                },
                {
                    id: 3,
                    type: "reply",
                    userId: 2,
                    userName: "Shikhar Dixit",
                    userUsername: "shikhard",
                    pollId: 1,
                    pollQuestion: "What's your favorite programming language for web development?",
                    commentId: 2,
                    timestamp: "45 minutes ago",
                    read: false
                },
                {
                    id: 4,
                    type: "like_comment",
                    userId: 4,
                    userName: "Nishkarsh Mishra",
                    userUsername: "nishkarsh",
                    pollId: 1,
                    pollQuestion: "What's your favorite programming language for web development?",
                    commentId: 4,
                    timestamp: "30 minutes ago",
                    read: false
                },
                {
                    id: 5,
                    type: "follow",
                    userId: 5,
                    userName: "Swatantra Singh",
                    userUsername: "swatantra",
                    pollId: null,
                    pollQuestion: null,
                    commentId: null,
                    timestamp: "1 day ago",
                    read: true
                }
            ],
            nextPollId: 5,
            nextCommentId: 6,
            nextNotificationId: 6,
            nextMessageId: 4,
            currentReplyingTo: null,
            activeDropdown: null,
            currentViewingUser: null
        };

        // DOM Elements
        const pollsContainer = document.getElementById('pollsContainer');
        const userPollsContainer = document.getElementById('userPollsContainer');
        const userCommentsContainer = document.getElementById('userCommentsContainer');
        const otherUserPollsContainer = document.getElementById('otherUserPollsContainer');
        const otherUserCommentsContainer = document.getElementById('otherUserCommentsContainer');
        const commentsList = document.getElementById('commentsList');
        const commentPollQuestion = document.getElementById('commentPollQuestion');
        const commentInput = document.getElementById('commentInput');
        const profilePicLarge = document.getElementById('profilePicLarge');
        const profileName = document.getElementById('profileName');
        const profileUsername = document.getElementById('profileUsername');
        const profileBio = document.getElementById('profileBio');
        const profileGender = document.getElementById('profileGender');
        const profilePronoun = document.getElementById('profilePronoun');
        const userProfilePicLarge = document.getElementById('userProfilePicLarge');
        const userProfileName = document.getElementById('userProfileName');
        const userProfileUsername = document.getElementById('userProfileUsername');
        const userProfileBio = document.getElementById('userProfileBio');
        const userProfileGender = document.getElementById('userProfileGender');
        const userProfilePronoun = document.getElementById('userProfilePronoun');
        const userFollowers = document.getElementById('userFollowers');
        const userImpressions = document.getElementById('userImpressions');
        const userLikes = document.getElementById('userLikes');
        const followUserBtn = document.getElementById('followUserBtn');
        const chatUserBtn = document.getElementById('chatUserBtn');
        const profilePicPreview = document.getElementById('profilePicPreview');
        const profilePicInput = document.getElementById('profilePicInput');
        const pollImagePreview = document.getElementById('pollImagePreview');
        const loginMethodValue = document.getElementById('loginMethodValue');
        const themeValue = document.getElementById('themeValue');
        const privacyValue = document.getElementById('privacyValue');
        const notificationValue = document.getElementById('notificationValue');
        const settingsBtn = document.getElementById('settingsBtn');
        const editProfileBtn = document.getElementById('editProfileBtn');
        const profileSettingsBtn = document.getElementById('profileSettingsBtn');
        const messageUserList = document.getElementById('messageUserList');
        const messageThread = document.getElementById('messageThread');
        const messagesContainer = document.getElementById('messagesContainer');
        const currentMessageUser = document.getElementById('currentMessageUser');
        const messageInput = document.getElementById('messageInput');
        const sendMessageBtn = document.getElementById('sendMessage');
        const backToMessages = document.getElementById('backToMessages');
        const notificationsContainer = document.getElementById('notificationsContainer');
        const replyingTo = document.getElementById('replyingTo');
        const replyingToText = document.getElementById('replyingToText');
        const cancelReply = document.getElementById('cancelReply');
        const reportModal = document.getElementById('reportModal');
        const cancelReport = document.getElementById('cancelReport');
        const submitReport = document.getElementById('submitReport');
        const privacySettingsModal = document.getElementById('privacySettingsModal');
        const themeSettingsModal = document.getElementById('themeSettingsModal');
        const notificationSettingsModal = document.getElementById('notificationSettingsModal');

        // Initialize the app
        function initApp() {
            renderPolls();
            renderUserPolls();
            renderUserComments();
            renderMessageUsers();
            renderNotifications();
            updateProfileDisplay();
            updateSettingsDisplay();
            setupEventListeners();
            applyTheme();
        }

        // Apply theme based on user preference
        function applyTheme() {
            if (appState.currentUser.theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else if (appState.currentUser.theme === 'light') {
                document.body.classList.remove('dark-mode');
            } else {
                // Auto mode - follow system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add('dark-mode');
                } else {
                    document.body.classList.remove('dark-mode');
                }
            }
        }

        // Render polls to the home screen
        function renderPolls() {
            pollsContainer.innerHTML = '';
            
            if (appState.polls.length === 0) {
                pollsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-poll"></i>
                        <p>No polls yet. Be the first to create one!</p>
                    </div>
                `;
                return;
            }
            
            // Sort polls by timestamp (newest first)
            const sortedPolls = [...appState.polls].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            sortedPolls.forEach(poll => {
                const pollElement = createPollElement(poll);
                pollsContainer.appendChild(pollElement);
            });
        }

        // Render user's polls to the profile screen
        function renderUserPolls() {
            userPollsContainer.innerHTML = '';
            
            if (appState.userPolls.length === 0) {
                userPollsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-poll"></i>
                        <p>You haven't created any polls yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort user polls by timestamp (newest first)
            const sortedPolls = [...appState.userPolls].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            sortedPolls.forEach(poll => {
                const pollElement = createPollElement(poll);
                userPollsContainer.appendChild(pollElement);
            });
        }

        // Render other user's polls
        function renderOtherUserPolls(userId) {
            otherUserPollsContainer.innerHTML = '';
            
            const userPolls = appState.polls.filter(poll => poll.userId === userId);
            
            if (userPolls.length === 0) {
                otherUserPollsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-poll"></i>
                        <p>This user hasn't created any polls yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort polls by timestamp (newest first)
            const sortedPolls = [...userPolls].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            sortedPolls.forEach(poll => {
                const pollElement = createPollElement(poll);
                otherUserPollsContainer.appendChild(pollElement);
            });
        }

        // Render user's comments to the profile screen
        function renderUserComments() {
            userCommentsContainer.innerHTML = '';
            
            const userComments = getAllUserComments(appState.currentUser.id);
            
            if (userComments.length === 0) {
                userCommentsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-comments"></i>
                        <p>You haven't commented on any polls yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort comments by timestamp (newest first)
            const sortedComments = [...userComments].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            sortedComments.forEach(comment => {
                const poll = appState.polls.find(p => p.id === comment.pollId) || 
                            appState.userPolls.find(p => p.id === comment.pollId);
                
                if (poll) {
                    const commentElement = createUserCommentElement(comment, poll);
                    userCommentsContainer.appendChild(commentElement);
                }
            });
        }

        // Render other user's comments
        function renderOtherUserComments(userId) {
            otherUserCommentsContainer.innerHTML = '';
            
            const userComments = getAllUserComments(userId);
            
            if (userComments.length === 0) {
                otherUserCommentsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-comments"></i>
                        <p>This user hasn't commented on any polls yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort comments by timestamp (newest first)
            const sortedComments = [...userComments].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            sortedComments.forEach(comment => {
                const poll = appState.polls.find(p => p.id === comment.pollId) || 
                            appState.userPolls.find(p => p.id === comment.pollId);
                
                if (poll) {
                    const commentElement = createUserCommentElement(comment, poll);
                    otherUserCommentsContainer.appendChild(commentElement);
                }
            });
        }

        // Get all user comments including replies
        function getAllUserComments(userId) {
            const userComments = [];
            
            function searchComments(comments) {
                comments.forEach(comment => {
                    if (comment.userId === userId) {
                        userComments.push(comment);
                    }
                    if (comment.replies && comment.replies.length > 0) {
                        searchComments(comment.replies);
                    }
                });
            }
            
            searchComments(appState.comments);
            return userComments;
        }

        // Render message users
        function renderMessageUsers() {
            messageUserList.innerHTML = '';
            
            if (appState.messageUsers.length === 0) {
                messageUserList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <p>No messages yet. Start following people to chat!</p>
                    </div>
                `;
                return;
            }
            
            appState.messageUsers.forEach(user => {
                const userElement = createMessageUserElement(user);
                messageUserList.appendChild(userElement);
            });
        }

        // Render notifications
        function renderNotifications() {
            notificationsContainer.innerHTML = '';
            
            if (appState.notifications.length === 0) {
                notificationsContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-bell"></i>
                        <p>No notifications yet.</p>
                    </div>
                `;
                return;
            }
            
            // Sort notifications by timestamp (newest first)
            const sortedNotifications = [...appState.notifications].sort((a, b) => {
                return new Date(b.timestamp) - new Date(a.timestamp);
            });
            
            sortedNotifications.forEach(notification => {
                const notificationElement = createNotificationElement(notification);
                notificationsContainer.appendChild(notificationElement);
            });
        }

        // Create a poll element
        function createPollElement(poll) {
            const pollElement = document.createElement('div');
            pollElement.className = 'poll-card';
            pollElement.dataset.pollId = poll.id;
            
            let optionsHTML = '';
            poll.options.forEach(option => {
                const isSelected = poll.userVoted && poll.userVoteOption === option.id;
                const selectedClass = isSelected ? 'selected' : '';
                
                optionsHTML += `
                    <div class="poll-option ${selectedClass}" data-option-id="${option.id}" data-poll-id="${poll.id}">
                        <div class="percentage-bar" style="width: ${poll.userVoted ? option.percentage : 0}%"></div>
                        <div class="option-text">
                            <span>${option.text}</span>
                            ${poll.userVoted ? `<span class="percentage">${option.percentage}%</span>` : ''}
                        </div>
                    </div>
                `;
            });
            
            const likeClass = poll.userLiked ? 'fas fa-heart active' : 'far fa-heart';
            const profilePicContent = poll.userProfilePic ? 
                `<img src="${poll.userProfilePic}" alt="${poll.userName}">` : 
                `<i class="fas fa-user"></i>`;
            
            // Check if poll belongs to current user
            const isOwnPoll = poll.userId === appState.currentUser.id;
            
            pollElement.innerHTML = `
                <div class="poll-header">
                    <div class="profile-pic" data-user-id="${poll.userId}">
                        ${profilePicContent}
                    </div>
                    <div class="user-info">
                        <div class="username" data-user-id="${poll.userId}">
                            ${poll.userName}
                            ${isOwnPoll ? `<i class="fas fa-pencil-alt username-edit"></i>` : ''}
                        </div>
                        <div class="user-display-name">@${poll.userUsername}</div>
                        <div class="timestamp">${poll.timestamp}</div>
                    </div>
                    <button class="poll-menu-btn">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                    <div class="dropdown-menu poll-dropdown">
                        ${isOwnPoll ? `
                            <div class="dropdown-item delete">
                                <i class="fas fa-trash"></i> Delete Poll
                            </div>
                            <div class="dropdown-item edit">
                                <i class="fas fa-edit"></i> Edit Poll
                            </div>
                        ` : `
                            <div class="dropdown-item report">
                                <i class="fas fa-flag"></i> Report
                            </div>
                        `}
                    </div>
                </div>
                <div class="poll-question">${poll.question}</div>
                ${poll.image ? `<img src="${poll.image}" alt="Poll image" class="poll-image">` : ''}
                <div class="poll-stats">
                    <span><i class="fas fa-eye"></i> ${poll.impressions.toLocaleString()} impressions</span>
                    <span><i class="fas fa-chart-bar"></i> ${poll.options.reduce((sum, opt) => sum + opt.votes, 0)} total votes</span>
                </div>
                <div class="poll-options">
                    ${optionsHTML}
                </div>
                <div class="engagement-bar">
                    <div class="engagement-item like-btn" data-poll-id="${poll.id}">
                        <i class="engagement-icon ${likeClass}"></i>
                        <span>${poll.likes}</span>
                    </div>
                    <div class="engagement-item comment-btn" data-poll-id="${poll.id}">
                        <i class="engagement-icon far fa-comment"></i>
                        <span>${poll.comments}</span>
                    </div>
                    <div class="engagement-item">
                        <i class="engagement-icon fas fa-share"></i>
                        <span>${poll.shares}</span>
                    </div>
                </div>
            `;
            
            return pollElement;
        }

        // Create user comment element for profile
        function createUserCommentElement(comment, poll) {
            const commentElement = document.createElement('div');
            commentElement.className = 'recent-comment';
            commentElement.dataset.pollId = poll.id;
            commentElement.dataset.commentId = comment.id;
            
            // Check if comment belongs to current user
            const isOwnComment = comment.userId === appState.currentUser.id;
            
            commentElement.innerHTML = `
                <div class="comment-poll-preview">
                    <i class="fas fa-poll"></i>
                </div>
                <div class="comment-content">
                    <div class="comment-poll-question">${poll.question}</div>
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-timestamp">${comment.timestamp}</div>
                </div>
                <button class="comment-menu-btn">
                    <i class="fas fa-ellipsis-h"></i>
                </button>
                <div class="dropdown-menu comment-dropdown">
                    ${isOwnComment ? `
                        <div class="dropdown-item delete">
                            <i class="fas fa-trash"></i> Delete
                        </div>
                        <div class="dropdown-item edit">
                            <i class="fas fa-edit"></i> Edit
                        </div>
                    ` : `
                        <div class="dropdown-item report">
                            <i class="fas fa-flag"></i> Report
                        </div>
                    `}
                </div>
            `;
            
            return commentElement;
        }

        // Create message user element
        function createMessageUserElement(user) {
            const userElement = document.createElement('div');
            userElement.className = 'message-user-item';
            userElement.dataset.userId = user.id;
            
            const lastMessage = user.messages[user.messages.length - 1];
            const profilePicContent = user.profilePic ? 
                `<img src="${user.profilePic}" alt="${user.name}">` : 
                `<i class="fas fa-user"></i>`;
            
            userElement.innerHTML = `
                <div class="profile-pic">
                    ${profilePicContent}
                </div>
                <div class="message-user-info">
                    <div class="message-user-name">${user.name}</div>
                    <div class="message-user-status">${user.status}  ${user.lastSeen}</div>
                </div>
                <div class="message-time">${lastMessage.timestamp}</div>
            `;
            
            return userElement;
        }

        // Create notification element
        function createNotificationElement(notification) {
            const notificationElement = document.createElement('div');
            notificationElement.className = 'notification-card';
            notificationElement.dataset.notificationId = notification.id;
            notificationElement.dataset.type = notification.type;
            notificationElement.dataset.pollId = notification.pollId;
            notificationElement.dataset.commentId = notification.commentId;
            notificationElement.dataset.userId = notification.userId;
            
            let icon = '';
            let text = '';
            
            switch (notification.type) {
                case 'like':
                    icon = 'fas fa-heart';
                    text = `<strong>${notification.userName}</strong> liked your poll "${notification.pollQuestion}"`;
                    break;
                case 'comment':
                    icon = 'fas fa-comment';
                    text = `<strong>${notification.userName}</strong> commented on your poll "${notification.pollQuestion}"`;
                    break;
                case 'reply':
                    icon = 'fas fa-reply';
                    text = `<strong>${notification.userName}</strong> replied to your comment on "${notification.pollQuestion}"`;
                    break;
                case 'like_comment':
                    icon = 'fas fa-heart';
                    text = `<strong>${notification.userName}</strong> liked your comment on "${notification.pollQuestion}"`;
                    break;
                case 'follow':
                    icon = 'fas fa-user-plus';
                    text = `<strong>${notification.userName}</strong> started following you`;
                    break;
                default:
                    icon = 'fas fa-bell';
                    text = `New notification`;
            }
            
            notificationElement.innerHTML = `
                <div class="notification-icon">
                    <i class="${icon}"></i>
                </div>
                <div class="notification-content">
                    <div class="notification-text">${text}</div>
                    <div class="notification-timestamp">${notification.timestamp}</div>
                </div>
            `;
            
            return notificationElement;
        }

        // Update profile display
        function updateProfileDisplay() {
            profileName.textContent = appState.currentUser.name;
            profileUsername.querySelector('span').textContent = `@${appState.currentUser.username}`;
            profileBio.textContent = appState.currentUser.bio;
            
            // Update gender and pronoun
            profileGender.textContent = formatGender(appState.currentUser.gender);
            profilePronoun.textContent = formatPronoun(appState.currentUser.pronoun);
            
            if (appState.currentUser.profilePic) {
                profilePicLarge.innerHTML = `<img src="${appState.currentUser.profilePic}" alt="${appState.currentUser.name}">`;
                profilePicPreview.innerHTML = `<img src="${appState.currentUser.profilePic}" alt="${appState.currentUser.name}"><div class="upload-text">Tap to change</div>`;
            } else {
                profilePicLarge.innerHTML = '<i class="fas fa-user"></i>';
                profilePicPreview.innerHTML = '<i class="fas fa-user fa-2x"></i><div class="upload-text">Tap to change</div>';
            }
        }

        // Format gender for display
        function formatGender(gender) {
            const genderMap = {
                'female': 'Female',
                'male': 'Male',
                'non-binary': 'Non-binary',
                'other': 'Other',
                'prefer-not-to-say': 'Prefer not to say'
            };
            return genderMap[gender] || 'Not specified';
        }

        // Format pronoun for display
        function formatPronoun(pronoun) {
            const pronounMap = {
                'she-her': 'She/Her',
                'he-him': 'He/Him',
                'they-them': 'They/Them',
                'other': 'Other',
                'prefer-not-to-say': 'Prefer not to say'
            };
            return pronounMap[pronoun] || 'Not specified';
        }

        // Update user profile display
        function updateUserProfileDisplay(user) {
            userProfileName.textContent = user.name;
            userProfileUsername.querySelector('span').textContent = `@${user.username}`;
            userProfileBio.textContent = user.bio;
            userFollowers.textContent = user.followers.toLocaleString();
            userImpressions.textContent = user.impressions.toLocaleString();
            userLikes.textContent = user.likes.toLocaleString();
            
            // Update gender and pronoun
            userProfileGender.textContent = formatGender(user.gender);
            userProfilePronoun.textContent = formatPronoun(user.pronoun);
            
            if (user.profilePic) {
                userProfilePicLarge.innerHTML = `<img src="${user.profilePic}" alt="${user.name}">`;
            } else {
                userProfilePicLarge.innerHTML = '<i class="fas fa-user"></i>';
            }
            
            // Update follow button
            if (user.isFollowing) {
                followUserBtn.textContent = 'Following';
                followUserBtn.classList.add('following');
            } else {
                followUserBtn.textContent = 'Follow';
                followUserBtn.classList.remove('following');
            }
        }

        // Update settings display
        function updateSettingsDisplay() {
            loginMethodValue.textContent = appState.currentUser.loginMethod === 'google' ? 'Google' : 'Phone';
            privacyValue.textContent = appState.currentUser.privacy === 'public' ? 'Public' : 'Private';
            themeValue.textContent = appState.currentUser.theme === 'auto' ? 'Auto' : 
                                   appState.currentUser.theme === 'light' ? 'Light' : 'Dark';
            notificationValue.textContent = appState.currentUser.notifications === 'enabled' ? 'Enabled' : 'Disabled';
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            const navItems = document.querySelectorAll('.nav-item');
            const screens = document.querySelectorAll('.screen');

            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const targetScreen = item.getAttribute('data-screen');
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show target screen
                    screens.forEach(screen => screen.classList.remove('active'));
                    document.getElementById(targetScreen).classList.add('active');
                    
                    // Show message user list when navigating to messages screen
                    if (targetScreen === 'messagesScreen') {
                        messageUserList.style.display = 'block';
                        messageThread.classList.remove('active');
                    }
                    
                    // Show/hide profile settings button
                    if (targetScreen === 'profileScreen') {
                        profileSettingsBtn.style.display = 'block';
                    } else {
                        profileSettingsBtn.style.display = 'none';
                    }
                });
            });

            // Profile settings button
            profileSettingsBtn.addEventListener('click', () => {
                navItems.forEach(nav => nav.classList.remove('active'));
                document.querySelector('.nav-item[data-screen="profileScreen"]').classList.add('active');
                screens.forEach(screen => screen.classList.remove('active'));
                document.getElementById('settingsScreen').classList.add('active');
            });

            // Settings button
            settingsBtn.addEventListener('click', () => {
                navItems.forEach(nav => nav.classList.remove('active'));
                document.querySelector('.nav-item[data-screen="profileScreen"]').classList.add('active');
                screens.forEach(screen => screen.classList.remove('active'));
                document.getElementById('settingsScreen').classList.add('active');
            });

            // Edit Profile button
            editProfileBtn.addEventListener('click', () => {
                document.getElementById('editDisplayName').value = appState.currentUser.name;
                document.getElementById('editUsername').value = appState.currentUser.username;
                document.getElementById('editGender').value = appState.currentUser.gender;
                document.getElementById('editPronoun').value = appState.currentUser.pronoun;
                document.getElementById('editBio').value = appState.currentUser.bio;
                document.getElementById('editProfileScreen').classList.add('active');
            });

            // Profile Tabs
            const profileTabs = document.querySelectorAll('.profile-tab');
            const tabContents = document.querySelectorAll('.tab-content');

            profileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    profileTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show target tab content
                    tabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${targetTab}Tab`).classList.add('active');
                });
            });

            // User Profile Tabs
            const userProfileTabs = document.querySelectorAll('#userProfileScreen .profile-tab');
            const userTabContents = document.querySelectorAll('#userProfileScreen .tab-content');

            userProfileTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.getAttribute('data-tab');
                    
                    // Update active tab
                    userProfileTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // Show target tab content
                    userTabContents.forEach(content => content.classList.remove('active'));
                    document.getElementById(`${targetTab}Tab`).classList.add('active');
                });
            });

            // Poll Voting
            document.addEventListener('click', (e) => {
                if (e.target.closest('.poll-option')) {
                    const optionElement = e.target.closest('.poll-option');
                    const pollId = parseInt(optionElement.dataset.pollId);
                    const optionId = parseInt(optionElement.dataset.optionId);
                    
                    voteOnPoll(pollId, optionId);
                }
            });

            // Like functionality
            document.addEventListener('click', (e) => {
                if (e.target.closest('.like-btn')) {
                    const likeBtn = e.target.closest('.like-btn');
                    const pollId = parseInt(likeBtn.dataset.pollId);
                    
                    toggleLike(pollId);
                }
            });

            // Comment functionality
            document.addEventListener('click', (e) => {
                if (e.target.closest('.comment-btn')) {
                    const commentBtn = e.target.closest('.comment-btn');
                    const pollId = parseInt(commentBtn.dataset.pollId);
                    
                    openComments(pollId);
                }
            });

            // User comment click (opens poll comments)
            document.addEventListener('click', (e) => {
                if (e.target.closest('.recent-comment')) {
                    const commentElement = e.target.closest('.recent-comment');
                    const pollId = parseInt(commentElement.dataset.pollId);
                    
                    openComments(pollId);
                }
            });

            // Message user click
            document.addEventListener('click', (e) => {
                if (e.target.closest('.message-user-item')) {
                    const userElement = e.target.closest('.message-user-item');
                    const userId = parseInt(userElement.dataset.userId);
                    
                    openMessageThread(userId);
                }
            });

            // Back to messages
            backToMessages.addEventListener('click', () => {
                messageThread.classList.remove('active');
                messageUserList.style.display = 'block';
            });

            // Send message
            sendMessageBtn.addEventListener('click', () => {
                sendMessage();
            });

            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            // Close Comments
            const closeCommentsBtn = document.getElementById('closeComments');
            closeCommentsBtn.addEventListener('click', () => {
                const commentScreen = document.getElementById('commentScreen');
                commentScreen.classList.remove('active');
                appState.currentReplyingTo = null;
                replyingTo.style.display = 'none';
            });

            // Send Comment
            const sendCommentBtn = document.getElementById('sendComment');
            sendCommentBtn.addEventListener('click', () => {
                sendComment();
            });

            commentInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendComment();
                }
            });

            // Cancel reply
            cancelReply.addEventListener('click', () => {
                appState.currentReplyingTo = null;
                replyingTo.style.display = 'none';
            });

            // Edit Profile
            const editProfileScreen = document.getElementById('editProfileScreen');
            const closeEditProfileBtn = document.getElementById('closeEditProfile');
            const cancelEditProfileBtn = document.getElementById('cancelEditProfile');
            const saveProfileBtn = document.getElementById('saveProfile');

            closeEditProfileBtn.addEventListener('click', () => {
                editProfileScreen.classList.remove('active');
            });

            cancelEditProfileBtn.addEventListener('click', () => {
                editProfileScreen.classList.remove('active');
            });

            saveProfileBtn.addEventListener('click', () => {
                saveProfile();
            });

            // Profile Picture Upload
            profilePicPreview.addEventListener('click', () => {
                profilePicInput.click();
            });

            profilePicInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        profilePicPreview.innerHTML = `<img src="${e.target.result}" alt="Profile preview"><div class="upload-text">Tap to change</div>`;
                        // Store temporarily, will save when user clicks Save
                        appState.currentUser.tempProfilePic = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Poll Image Upload
            const pollImageInput = document.getElementById('pollImage');
            pollImageInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        pollImagePreview.src = e.target.result;
                        pollImagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Create Poll Functionality
            const addOptionBtn = document.getElementById('addOption');
            const pollOptionsContainer = document.getElementById('pollOptionsContainer');
            const postPollBtn = document.getElementById('postPoll');

            addOptionBtn.addEventListener('click', () => {
                addPollOption();
            });

            postPollBtn.addEventListener('click', () => {
                createPoll();
            });

            // Settings
            const logoutBtn = document.getElementById('logoutBtn');
            const deleteAccountBtn = document.getElementById('deleteAccountBtn');
            const cancelLogout = document.getElementById('cancelLogout');
            const confirmLogout = document.getElementById('confirmLogout');
            const cancelDelete = document.getElementById('cancelDelete');
            const confirmDelete = document.getElementById('confirmDelete');

            logoutBtn.addEventListener('click', () => {
                document.getElementById('logoutModal').classList.add('active');
            });

            deleteAccountBtn.addEventListener('click', () => {
                document.getElementById('deleteAccountModal').classList.add('active');
            });

            cancelLogout.addEventListener('click', () => {
                document.getElementById('logoutModal').classList.remove('active');
            });

            confirmLogout.addEventListener('click', () => {
                alert('You have been logged out successfully!');
                document.getElementById('logoutModal').classList.remove('active');
                // In a real app, you would redirect to login page
            });

            cancelDelete.addEventListener('click', () => {
                document.getElementById('deleteAccountModal').classList.remove('active');
            });

            confirmDelete.addEventListener('click', () => {
                alert('Your account has been deleted successfully!');
                document.getElementById('deleteAccountModal').classList.remove('active');
                // In a real app, you would redirect to home page or login
            });

            // Report Modal
            cancelReport.addEventListener('click', () => {
                reportModal.classList.remove('active');
            });

            submitReport.addEventListener('click', () => {
                alert('Thank you for your report. We will review this content.');
                reportModal.classList.remove('active');
                
                // Reset checkboxes
                document.querySelectorAll('.report-option input').forEach(checkbox => {
                    checkbox.checked = false;
                });
                document.getElementById('custom-report').value = '';
            });

            // Settings Modals
            const privacySettingsItem = document.getElementById('privacySettingsItem');
            const themeSettingsItem = document.getElementById('themeSettingsItem');
            const notificationSettingsItem = document.getElementById('notificationSettingsItem');

            privacySettingsItem.addEventListener('click', () => {
                openSettingsModal('privacy');
            });

            themeSettingsItem.addEventListener('click', () => {
                openSettingsModal('theme');
            });

            notificationSettingsItem.addEventListener('click', () => {
                openSettingsModal('notification');
            });

            // Follow User
            followUserBtn.addEventListener('click', () => {
                if (appState.currentViewingUser) {
                    const user = appState.dummyUsers.find(u => u.id === appState.currentViewingUser.id);
                    if (user) {
                        user.isFollowing = !user.isFollowing;
                        if (user.isFollowing) {
                            user.followers += 1;
                            // Add follow notification
                            const newNotification = {
                                id: appState.nextNotificationId++,
                                type: "follow",
                                userId: appState.currentUser.id,
                                userName: appState.currentUser.name,
                                userUsername: appState.currentUser.username,
                                pollId: null,
                                pollQuestion: null,
                                commentId: null,
                                timestamp: "Just now",
                                read: false
                            };
                            appState.notifications.unshift(newNotification);
                            renderNotifications();
                        } else {
                            user.followers -= 1;
                        }
                        updateUserProfileDisplay(user);
                    }
                }
            });

            // Chat User
            chatUserBtn.addEventListener('click', () => {
                if (appState.currentViewingUser) {
                    // Navigate to messages screen
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelector('.nav-item[data-screen="messagesScreen"]').classList.add('active');
                    document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                    document.getElementById('messagesScreen').classList.add('active');
                    
                    // Open chat with this user
                    openMessageThread(appState.currentViewingUser.id);
                }
            });

            // User profile clicks
            document.addEventListener('click', (e) => {
                if (e.target.closest('.username') || e.target.closest('.profile-pic')) {
                    const element = e.target.closest('.username') || e.target.closest('.profile-pic');
                    const userId = parseInt(element.dataset.userId);
                    
                    if (userId !== appState.currentUser.id) {
                        openUserProfile(userId);
                    }
                }
            });

            // Notification clicks
            document.addEventListener('click', (e) => {
                if (e.target.closest('.notification-card')) {
                    const notificationElement = e.target.closest('.notification-card');
                    const type = notificationElement.dataset.type;
                    const pollId = parseInt(notificationElement.dataset.pollId);
                    const commentId = parseInt(notificationElement.dataset.commentId);
                    const userId = parseInt(notificationElement.dataset.userId);
                    
                    handleNotificationClick(type, pollId, commentId, userId);
                }
            });

            // Three-dot menu functionality
            document.addEventListener('click', (e) => {
                // Handle poll menu button clicks
                if (e.target.closest('.poll-menu-btn')) {
                    const menuBtn = e.target.closest('.poll-menu-btn');
                    const dropdown = menuBtn.nextElementSibling;
                    
                    // Close any other open dropdowns
                    closeAllDropdowns();
                    
                    // Toggle current dropdown
                    if (dropdown.style.display === 'block') {
                        dropdown.style.display = 'none';
                        appState.activeDropdown = null;
                    } else {
                        dropdown.style.display = 'block';
                        appState.activeDropdown = dropdown;
                        
                        // Position the dropdown
                        const rect = menuBtn.getBoundingClientRect();
                        dropdown.style.top = `${rect.bottom + 5}px`;
                        dropdown.style.right = `${window.innerWidth - rect.right}px`;
                    }
                    e.stopPropagation();
                }
                
                // Handle comment menu button clicks
                if (e.target.closest('.comment-menu-btn')) {
                    const menuBtn = e.target.closest('.comment-menu-btn');
                    const dropdown = menuBtn.nextElementSibling;
                    
                    // Close any other open dropdowns
                    closeAllDropdowns();
                    
                    // Toggle current dropdown
                    if (dropdown.style.display === 'block') {
                        dropdown.style.display = 'none';
                        appState.activeDropdown = null;
                    } else {
                        dropdown.style.display = 'block';
                        appState.activeDropdown = dropdown;
                        
                        // Position the dropdown
                        const rect = menuBtn.getBoundingClientRect();
                        dropdown.style.top = `${rect.bottom + 5}px`;
                        dropdown.style.right = `${window.innerWidth - rect.right}px`;
                    }
                    e.stopPropagation();
                }
                
                // Handle dropdown item clicks
                if (e.target.closest('.dropdown-item')) {
                    const dropdownItem = e.target.closest('.dropdown-item');
                    const dropdown = dropdownItem.closest('.dropdown-menu');
                    const parentElement = dropdown.closest('.poll-card, .recent-comment, .comment-item');
                    
                    if (dropdownItem.classList.contains('delete')) {
                        if (confirm('Are you sure you want to delete this?')) {
                            // In a real app, this would make an API call
                            // Remove the element from DOM
                            parentElement.remove();
                        }
                    } else if (dropdownItem.classList.contains('edit')) {
                        alert('Edit functionality would open here');
                    } else if (dropdownItem.classList.contains('report')) {
                        reportModal.classList.add('active');
                    }
                    
                    // Close dropdown
                    dropdown.style.display = 'none';
                    appState.activeDropdown = null;
                    e.stopPropagation();
                }
            });

            // Close dropdowns when clicking elsewhere
            document.addEventListener('click', () => {
                closeAllDropdowns();
            });
        }

        // Close all dropdown menus
        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                dropdown.style.display = 'none';
            });
            appState.activeDropdown = null;
        }

        // Open settings modal
        function openSettingsModal(type) {
            let modal;
            let currentValue;
            
            switch (type) {
                case 'privacy':
                    modal = privacySettingsModal;
                    currentValue = appState.currentUser.privacy;
                    break;
                case 'theme':
                    modal = themeSettingsModal;
                    currentValue = appState.currentUser.theme;
                    break;
                case 'notification':
                    modal = notificationSettingsModal;
                    currentValue = appState.currentUser.notifications;
                    break;
            }
            
            // Reset all checkmarks
            modal.querySelectorAll('.settings-modal-option i').forEach(icon => {
                icon.style.display = 'none';
            });
            
            // Set checkmark for current value
            const currentOption = modal.querySelector(`.settings-modal-option[data-value="${currentValue}"]`);
            if (currentOption) {
                currentOption.querySelector('i').style.display = 'block';
            }
            
            // Add click handlers for options
            modal.querySelectorAll('.settings-modal-option').forEach(option => {
                option.addEventListener('click', () => {
                    // Remove checkmark from all options
                    modal.querySelectorAll('.settings-modal-option i').forEach(icon => {
                        icon.style.display = 'none';
                    });
                    
                    // Add checkmark to selected option
                    option.querySelector('i').style.display = 'block';
                });
            });
            
            // Add save handler
            const saveButton = modal.querySelector('.modal-btn-primary');
            saveButton.onclick = () => {
                const selectedOption = modal.querySelector('.settings-modal-option i[style*="block"]');
                if (selectedOption) {
                    const selectedValue = selectedOption.closest('.settings-modal-option').dataset.value;
                    
                    switch (type) {
                        case 'privacy':
                            appState.currentUser.privacy = selectedValue;
                            break;
                        case 'theme':
                            appState.currentUser.theme = selectedValue;
                            applyTheme();
                            break;
                        case 'notification':
                            appState.currentUser.notifications = selectedValue;
                            break;
                    }
                    
                    updateSettingsDisplay();
                    modal.classList.remove('active');
                }
            };
            
            // Add cancel handler
            const cancelButton = modal.querySelector('.modal-btn-secondary');
            cancelButton.onclick = () => {
                modal.classList.remove('active');
            };
            
            modal.classList.add('active');
        }

        // Open user profile
        function openUserProfile(userId) {
            const user = appState.dummyUsers.find(u => u.id === userId);
            if (user) {
                appState.currentViewingUser = user;
                updateUserProfileDisplay(user);
                renderOtherUserPolls(userId);
                renderOtherUserComments(userId);
                
                // Navigate to user profile screen
                document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
                document.getElementById('userProfileScreen').classList.add('active');
            }
        }

        // Handle notification click
        function handleNotificationClick(type, pollId, commentId, userId) {
            switch (type) {
                case 'like':
                case 'comment':
                    // Navigate to the poll
                    openComments(pollId);
                    break;
                case 'reply':
                case 'like_comment':
                    // Navigate to the poll and highlight the comment
                    openComments(pollId);
                    // In a real app, you would scroll to and highlight the specific comment
                    break;
                case 'follow':
                    // Navigate to the user's profile
                    openUserProfile(userId);
                    break;
            }
            
            // Mark notification as read
            const notification = appState.notifications.find(n => 
                n.type === type && n.pollId === pollId && n.commentId === commentId && n.userId === userId
            );
            if (notification) {
                notification.read = true;
            }
        }

        // Vote on a poll
        function voteOnPoll(pollId, optionId) {
            // Find the poll in either the main feed or user's polls
            let poll = appState.polls.find(p => p.id === pollId);
            let isUserPoll = false;
            
            if (!poll) {
                poll = appState.userPolls.find(p => p.id === pollId);
                isUserPoll = true;
            }
            
            if (!poll || poll.userVoted) return;
            
            // Update poll state
            poll.userVoted = true;
            poll.userVoteOption = optionId;
            
            // Update vote counts and percentages
            const totalVotes = poll.options.reduce((sum, option) => sum + option.votes, 0) + 1;
            
            poll.options.forEach(option => {
                if (option.id === optionId) {
                    option.votes += 1;
                }
                option.percentage = Math.round((option.votes / totalVotes) * 100);
            });
            
            // Re-render the poll
            if (isUserPoll) {
                renderUserPolls();
            } else {
                renderPolls();
            }
        }

        // Toggle like on a poll
        function toggleLike(pollId) {
            // Find the poll in either the main feed or user's polls
            let poll = appState.polls.find(p => p.id === pollId);
            let isUserPoll = false;
            
            if (!poll) {
                poll = appState.userPolls.find(p => p.id === pollId);
                isUserPoll = true;
            }
            
            if (!poll) return;
            
            // Update like state
            if (poll.userLiked) {
                poll.likes -= 1;
                poll.userLiked = false;
                
                // Remove like notification
                const notificationIndex = appState.notifications.findIndex(
                    n => n.type === 'like' && n.pollId === pollId && n.userId === appState.currentUser.id
                );
                if (notificationIndex !== -1) {
                    appState.notifications.splice(notificationIndex, 1);
                }
            } else {
                poll.likes += 1;
                poll.userLiked = true;
                
                // Add like notification (if not current user's poll)
                if (poll.userId !== appState.currentUser.id) {
                    const newNotification = {
                        id: appState.nextNotificationId++,
                        type: "like",
                        userId: appState.currentUser.id,
                        userName: appState.currentUser.name,
                        userUsername: appState.currentUser.username,
                        pollId: poll.id,
                        pollQuestion: poll.question,
                        commentId: null,
                        timestamp: "Just now",
                        read: false
                    };
                    appState.notifications.unshift(newNotification);
                    renderNotifications();
                }
            }
            
            // Re-render the poll
            if (isUserPoll) {
                renderUserPolls();
            } else {
                renderPolls();
            }
        }

        // Open comments for a poll
        function openComments(pollId) {
            const poll = appState.polls.find(p => p.id === pollId) || 
                         appState.userPolls.find(p => p.id === pollId);
            
            if (!poll) return;
            
            // Update the comment screen header
            commentPollQuestion.textContent = poll.question;
            
            // Render comments
            renderComments(pollId);
            
            // Show the comment screen
            const commentScreen = document.getElementById('commentScreen');
            commentScreen.classList.add('active');
            commentScreen.dataset.currentPollId = pollId;
        }

        // Render comments for a poll
        function renderComments(pollId) {
            commentsList.innerHTML = '';
            
            const pollComments = appState.comments.filter(comment => comment.pollId === pollId);
            
            if (pollComments.length === 0) {
                commentsList.innerHTML = `
                    <div class="empty-state">
                        <i class="far fa-comments"></i>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                `;
                return;
            }
            
            pollComments.forEach(comment => {
                const commentElement = createCommentElement(comment);
                commentsList.appendChild(commentElement);
                
                // Render replies recursively
                renderReplies(comment.replies, 1);
            });
        }

        // Render replies recursively
        function renderReplies(replies, depth) {
            replies.forEach(reply => {
                const replyElement = createCommentElement(reply, depth);
                commentsList.appendChild(replyElement);
                
                // Render nested replies
                if (reply.replies && reply.replies.length > 0) {
                    renderReplies(reply.replies, depth + 1);
                }
            });
        }

        // Create a comment element
        function createCommentElement(comment, depth = 0) {
            const isReply = depth > 0;
            const commentElement = document.createElement('div');
            commentElement.className = isReply ? (depth > 1 ? 'nested-reply' : 'reply-item') : 'comment-item';
            commentElement.dataset.commentId = comment.id;
            
            const likeClass = comment.userLiked ? 'fas fa-heart active' : 'far fa-heart';
            const profilePicContent = comment.userProfilePic ? 
                `<img src="${comment.userProfilePic}" alt="${comment.userName}">` : 
                `<i class="fas fa-user"></i>`;
            
            // Check if comment belongs to current user
            const isOwnComment = comment.userId === appState.currentUser.id;
            
            commentElement.innerHTML = `
                <div class="profile-pic" data-user-id="${comment.userId}">
                    ${profilePicContent}
                </div>
                <div class="comment-content">
                    <div class="comment-user" data-user-id="${comment.userId}">${comment.userName}</div>
                    <div class="comment-text">${comment.text}</div>
                    <div class="comment-actions">
                        <div class="comment-action">${comment.timestamp}</div>
                        <div class="comment-action like-comment-btn" data-comment-id="${comment.id}">
                            <i class="${likeClass}"></i> ${comment.likes}
                        </div>
                        <button class="reply-btn" data-comment-id="${comment.id}" data-user-name="${comment.userName}">
                            Reply
                        </button>
                    </div>
                </div>
                <button class="comment-menu-btn">
                    <i class="fas fa-ellipsis-h"></i>
                </button>
                <div class="dropdown-menu comment-dropdown">
                    ${isOwnComment ? `
                        <div class="dropdown-item delete">
                            <i class="fas fa-trash"></i> Delete
                        </div>
                        <div class="dropdown-item edit">
                            <i class="fas fa-edit"></i> Edit
                        </div>
                    ` : `
                        <div class="dropdown-item report">
                            <i class="fas fa-flag"></i> Report
                        </div>
                    `}
                </div>
            `;
            
            return commentElement;
        }

        // Send a comment
        function sendComment() {
            const commentText = commentInput.value.trim();
            if (!commentText) return;
            
            const pollId = parseInt(document.getElementById('commentScreen').dataset.currentPollId);
            
            // Create new comment or reply
            const newComment = {
                id: appState.nextCommentId++,
                pollId: pollId,
                userId: appState.currentUser.id,
                userName: appState.currentUser.name,
                userUsername: appState.currentUser.username,
                userProfilePic: appState.currentUser.profilePic,
                text: appState.currentReplyingTo ? commentText : commentText,
                likes: 0,
                timestamp: "Just now",
                userLiked: false,
                replies: []
            };
            
            if (appState.currentReplyingTo) {
                // Add as reply
                const parentComment = findCommentById(appState.currentReplyingTo.commentId);
                if (parentComment) {
                    parentComment.replies.push(newComment);
                    
                    // Add reply notification (if not replying to own comment)
                    if (parentComment.userId !== appState.currentUser.id) {
                        const newNotification = {
                            id: appState.nextNotificationId++,
                            type: "reply",
                            userId: appState.currentUser.id,
                            userName: appState.currentUser.name,
                            userUsername: appState.currentUser.username,
                            pollId: pollId,
                            pollQuestion: document.getElementById('commentPollQuestion').textContent,
                            commentId: parentComment.id,
                            timestamp: "Just now",
                            read: false
                        };
                        appState.notifications.unshift(newNotification);
                        renderNotifications();
                    }
                }
            } else {
                // Add as top-level comment
                appState.comments.push(newComment);
                
                // Update poll comment count
                let poll = appState.polls.find(p => p.id === pollId);
                let isUserPoll = false;
                
                if (!poll) {
                    poll = appState.userPolls.find(p => p.id === pollId);
                    isUserPoll = true;
                }
                
                if (poll) {
                    poll.comments += 1;
                }
                
                // Add comment notification (if not current user's poll)
                if (poll && poll.userId !== appState.currentUser.id) {
                    const newNotification = {
                        id: appState.nextNotificationId++,
                        type: "comment",
                        userId: appState.currentUser.id,
                        userName: appState.currentUser.name,
                        userUsername: appState.currentUser.username,
                        pollId: pollId,
                        pollQuestion: poll.question,
                        commentId: newComment.id,
                        timestamp: "Just now",
                        read: false
                    };
                    appState.notifications.unshift(newNotification);
                    renderNotifications();
                }
            }
            
            // Clear input and reset reply state
            commentInput.value = '';
            appState.currentReplyingTo = null;
            replyingTo.style.display = 'none';
            
            // Re-render comments
            renderComments(pollId);
            
            // Re-render polls and user comments
            if (isUserPoll) {
                renderUserPolls();
            } else {
                renderPolls();
            }
            
            renderUserComments();
        }

        // Find comment by ID (including replies)
        function findCommentById(commentId) {
            function searchComments(comments) {
                for (const comment of comments) {
                    if (comment.id === commentId) {
                        return comment;
                    }
                    if (comment.replies && comment.replies.length > 0) {
                        const found = searchComments(comment.replies);
                        if (found) return found;
                    }
                }
                return null;
            }
            
            return searchComments(appState.comments);
        }

        // Open message thread
        function openMessageThread(userId) {
            const user = appState.messageUsers.find(u => u.id === userId);
            if (!user) return;
            
            currentMessageUser.textContent = user.name;
            renderMessages(user.messages);
            
            messageUserList.style.display = 'none';
            messageThread.classList.add('active');
        }

        // Render messages
        function renderMessages(messages) {
            messagesContainer.innerHTML = '';
            
            messages.forEach(message => {
                const messageElement = document.createElement('div');
                messageElement.className = `message-bubble ${message.senderId === appState.currentUser.id ? 'message-sent' : 'message-received'}`;
                messageElement.innerHTML = message.text;
                messagesContainer.appendChild(messageElement);
            });
            
            // Scroll to bottom
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // Send message
        function sendMessage() {
            const messageText = messageInput.value.trim();
            if (!messageText) return;
            
            const currentUserId = parseInt(document.querySelector('.message-user-item.active')?.dataset.userId);
            if (!currentUserId) return;
            
            const user = appState.messageUsers.find(u => u.id === currentUserId);
            if (!user) return;
            
            // Add new message
            const newMessage = {
                id: appState.nextMessageId++,
                senderId: appState.currentUser.id,
                text: messageText,
                timestamp: "Just now"
            };
            
            user.messages.push(newMessage);
            
            // Clear input
            messageInput.value = '';
            
            // Re-render messages
            renderMessages(user.messages);
        }

        // Add poll option
        function addPollOption() {
            const optionCount = document.querySelectorAll('.poll-option-input').length;
            if (optionCount >= 6) {
                alert('Maximum 6 options allowed');
                return;
            }
            
            const newOption = document.createElement('div');
            newOption.className = 'poll-option-input';
            newOption.innerHTML = `
                <input type="text" class="form-input poll-option-input-field" placeholder="Option ${optionCount + 1}">
                <button class="remove-option"><i class="fas fa-times"></i></button>
            `;
            
            pollOptionsContainer.appendChild(newOption);
            
            // Show remove buttons if there are more than 2 options
            if (optionCount + 1 > 2) {
                const removeButtons = pollOptionsContainer.querySelectorAll('.remove-option');
                removeButtons.forEach(btn => btn.classList.remove('hidden'));
            }
        }

        // Remove poll option
        document.addEventListener('click', (e) => {
            if (e.target.closest('.remove-option')) {
                const optionInput = e.target.closest('.poll-option-input');
                if (document.querySelectorAll('.poll-option-input').length > 2) {
                    optionInput.remove();
                    
                    // Hide remove buttons if only 2 options left
                    if (document.querySelectorAll('.poll-option-input').length === 2) {
                        const removeButtons = document.querySelectorAll('.remove-option');
                        removeButtons.forEach(btn => btn.classList.add('hidden'));
                    }
                }
            }
        });

        // Create a new poll
        function createPoll() {
            const question = document.getElementById('pollQuestion').value.trim();
            if (!question) {
                alert('Please enter a poll question');
                return;
            }
            
            const optionInputs = document.querySelectorAll('.poll-option-input-field');
            const options = [];
            
            optionInputs.forEach(input => {
                if (input.value.trim()) {
                    options.push(input.value.trim());
                }
            });
            
            if (options.length < 2) {
                alert('Please add at least 2 options');
                return;
            }
            
            // Get poll image
            const pollImage = document.getElementById('pollImagePreview').style.display === 'block' ? 
                document.getElementById('pollImagePreview').src : null;
            
            // Create new poll
            const newPoll = {
                id: appState.nextPollId++,
                userId: appState.currentUser.id,
                userName: appState.currentUser.name,
                userUsername: appState.currentUser.username,
                userProfilePic: appState.currentUser.profilePic,
                question: question,
                options: options.map((text, index) => ({
                    id: index + 1,
                    text: text,
                    votes: 0,
                    percentage: 0
                })),
                image: pollImage,
                likes: 0,
                comments: 0,
                shares: 0,
                impressions: 0,
                timestamp: "Just now",
                userVoted: false,
                userVoteOption: null,
                userLiked: false
            };
            
            // Add to polls and user's polls
            appState.polls.unshift(newPoll);
            appState.userPolls.unshift(newPoll);
            
            // Reset form
            document.getElementById('pollQuestion').value = '';
            optionInputs.forEach(input => input.value = '');
            document.getElementById('pollImage').value = '';
            pollImagePreview.style.display = 'none';
            
            // Reset to 2 options
            const pollOptionsContainer = document.getElementById('pollOptionsContainer');
            pollOptionsContainer.innerHTML = `
                <div class="poll-option-input">
                    <input type="text" class="form-input poll-option-input-field" placeholder="Option 1">
                    <button class="remove-option hidden"><i class="fas fa-times"></i></button>
                </div>
                <div class="poll-option-input">
                    <input type="text" class="form-input poll-option-input-field" placeholder="Option 2">
                    <button class="remove-option hidden"><i class="fas fa-times"></i></button>
                </div>
            `;
            
            // Re-render polls
            renderPolls();
            renderUserPolls();
            
            // Switch to home screen
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector('.nav-item[data-screen="homeScreen"]').classList.add('active');
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById('homeScreen').classList.add('active');
            
            // No popup alert - just post silently
        }

        // Save profile
        function saveProfile() {
            const displayName = document.getElementById('editDisplayName').value.trim();
            const username = document.getElementById('editUsername').value.trim();
            const gender = document.getElementById('editGender').value;
            const pronoun = document.getElementById('editPronoun').value;
            const bio = document.getElementById('editBio').value.trim();
            
            if (!displayName || !username) {
                alert('Please enter both display name and username');
                return;
            }
            
            // Update current user
            appState.currentUser.name = displayName;
            appState.currentUser.username = username;
            appState.currentUser.gender = gender;
            appState.currentUser.pronoun = pronoun;
            appState.currentUser.bio = bio;
            
            // Update profile picture if changed
            if (appState.currentUser.tempProfilePic) {
                appState.currentUser.profilePic = appState.currentUser.tempProfilePic;
                delete appState.currentUser.tempProfilePic;
            }
            
            // Update user's polls
            appState.userPolls.forEach(poll => {
                poll.userName = displayName;
                poll.userUsername = username;
                poll.userProfilePic = appState.currentUser.profilePic;
            });
            
            // Update polls where current user has commented
            appState.comments.forEach(comment => {
                if (comment.userId === appState.currentUser.id) {
                    comment.userName = displayName;
                    comment.userUsername = username;
                    comment.userProfilePic = appState.currentUser.profilePic;
                }
                comment.replies.forEach(reply => {
                    if (reply.userId === appState.currentUser.id) {
                        reply.userName = displayName;
                        reply.userUsername = username;
                        reply.userProfilePic = appState.currentUser.profilePic;
                    }
                });
            });
            
            // Close edit screen
            document.getElementById('editProfileScreen').classList.remove('active');
            
            // Re-render profile and polls
            renderPolls();
            renderUserPolls();
            renderUserComments();
            updateProfileDisplay();
        }

        // Initialize the app when the page loads
        document.addEventListener('DOMContentLoaded', initApp);

        // Add event listener for reply buttons
        document.addEventListener('click', (e) => {
            if (e.target.closest('.reply-btn')) {
                const replyBtn = e.target.closest('.reply-btn');
                const commentId = parseInt(replyBtn.dataset.commentId);
                const userName = replyBtn.dataset.userName;
                
                appState.currentReplyingTo = {
                    commentId: commentId,
                    userName: userName
                };
                
                replyingToText.innerHTML = `Replying to <strong>${userName}</strong>`;
                replyingTo.style.display = 'flex';
                commentInput.focus();
                commentInput.value = '';
            }
        });

        // Add event listener for comment likes
        document.addEventListener('click', (e) => {
            if (e.target.closest('.like-comment-btn')) {
                const likeBtn = e.target.closest('.like-comment-btn');
                const commentId = parseInt(likeBtn.dataset.commentId);
                
                toggleCommentLike(commentId);
            }
        });

        // Toggle comment like
        function toggleCommentLike(commentId) {
            const comment = findCommentById(commentId);
            if (!comment) return;
            
            if (comment.userLiked) {
                comment.likes -= 1;
                comment.userLiked = false;
                
                // Remove like notification
                const notificationIndex = appState.notifications.findIndex(
                    n => n.type === 'like_comment' && n.commentId === commentId && n.userId === appState.currentUser.id
                );
                if (notificationIndex !== -1) {
                    appState.notifications.splice(notificationIndex, 1);
                }
            } else {
                comment.likes += 1;
                comment.userLiked = true;
                
                // Add like notification (if not current user's comment)
                if (comment.userId !== appState.currentUser.id) {
                    const poll = appState.polls.find(p => p.id === comment.pollId) || 
                                appState.userPolls.find(p => p.id === comment.pollId);
                    
                    if (poll) {
                        const newNotification = {
                            id: appState.nextNotificationId++,
                            type: "like_comment",
                            userId: appState.currentUser.id,
                            userName: appState.currentUser.name,
                            userUsername: appState.currentUser.username,
                            pollId: comment.pollId,
                            pollQuestion: poll.question,
                            commentId: commentId,
                            timestamp: "Just now",
                            read: false
                        };
                        appState.notifications.unshift(newNotification);
                        renderNotifications();
                    }
                }
            }
            
            // Re-render comments
            const pollId = parseInt(document.getElementById('commentScreen').dataset.currentPollId);
            if (pollId) {
                renderComments(pollId);
            }
        }
    </script>
</body>
</html>
